(function(){var s,ut,r,k,w,l;try{var e=Microsoft.Maps,f=e.Internal,o=f.__assign,g=f.__extends,et=f.__spreadArray,a=e.globalConfig,p=f.coreConfig,t=a.features,wt=t.advertising,bt=t.autosuggest,kt=t.calendar,dt=t.collections,gt=t.directions,ni=t.feedback,ti=t.flyover,ii=t.landmarks3D,ri=t.map3D,ui=t.richMapsInfobox,nt=t.labels,fi=t.layerManager,ei=t.localGuide,oi=t.localSearch,si=t.mapBuilder,hi=t.mapDelay,ci=t.optIn,li=t.print,ai=t.sharing,vi=t.streetside,yi=t.taskBar,pi=t.taskFramework,wi=t.trafficControl,bi=t.traffic,ki=t.trafficExperiences,di=t.mapBuilderExperiences,gi=t.transit,nr=t.travel,i=t.xsr,tr=atlas.math,u=atlas.data,v=atlas.layer,ot=atlas.Pixel,st=e.Anchor,ht=e.Delegates,ct=e.GeoJSON,tt=e.Point,c=e.Rectangle,it=e.Size,n=f.AtlasHelper,b=f.AzureMapEvents,lt=f.BootstrapView,at=f.CommandQueue,vt=f.ExternalPromise,h=f.JSEvent,yt=f.LruCache,pt=f.MapMath,y=f.Network,rt=f.ObjectWithId,d=f.TimeoutWrapper;(function(n){function t(n){return typeof n=="object"?n.property:undefined}function r(n,i,r){var u,e,f;return typeof n=="string"?u=n:n&&(e=t(n),u=i.getColorPaletteValue(e,r),u||(u=n.value||s.transparent)),u&&(f=s.parse(u,2),u=f&&f.toRgba()),u}function e(n,t,u,f){var e=t===null||t===void 0?void 0:t[n===null||n===void 0?void 0:n.ref],o,s,h,c,l;if(!e||!i.useXsrGradients)return null;if(o=null,e.type==="linearGradient"&&(o={gradientType:"linear",x0:e.x1,x1:e.x2,y0:e.y1,y1:e.y2,stops:[]}),o)for(s=0,h=e.stops;s<h.length;s++)c=h[s],l=r(c.color,u,f)||"#f0f",o.stops.push({offset:c.offset,color:l});return o}function h(n,i,r){if(typeof n=="number")return n;if(n){var u=t(n);return i.getNumericPaletteValue(u,r)}return 1}function a(n){var t=0;switch(n){case"bold":t=1;break;case"semiBold":t=16;break;case"light":t=32}return t}function c(n){var i=[],t;if(n.length%2==0)for(t=0;t<n.length;t+=2)i.push({x:n[t],y:n[t+1]});return i}function f(n,i,u,f,o){function k(n,i){var s=i.style,c=r(n.stroke,f,o),l=e(n.stroke,u,f,o);(c||l)&&(s.strokeStyle=c,s.strokeGradient=l,s.lineWidth=n.strokeWidth||1,s.lineWidthScale=h(n.strokeScale,f,o),i.strokeScalePaletteKey=t(n.strokeScale),i.strokeStylePaletteKey=t(n.stroke))}function p(n,i){k(n,i);var s=r(n.fill,f,o),h=e(n.fill,u,f,o);(s||h)&&(i.style.fillStyle=s,i.style.fillGradient=h,i.fillStylePaletteKey=t(n.fill))}var s=null;switch(n.type){case"circle":s={vectorType:2,centerX:n.centerX||0,centerY:n.centerY||0,radiusX:n.radius||0,radiusY:n.radius||0,style:{}};p(n,s);break;case"ellipse":s={vectorType:2,centerX:n.centerX||0,centerY:n.centerY||0,radiusX:n.radiusX||0,radiusY:n.radiusY||0,style:{}};p(n,s);break;case"line":s={vectorType:1,pointsList:[{x:n.x1||0,y:n.y1||0},{x:n.x2||0,y:n.y2||0}],style:{lineCap:n.lineCap||"butt",lineJoin:n.lineJoin||"round"}};k(n,s);break;case"path":s={vectorType:4,pathData:n.data,style:{}};p(n,s);break;case"polygon":s={vectorType:0,pointsList:c(n.points),style:{}};p(n,s);break;case"polyline":s={vectorType:1,pointsList:c(n.points),style:{lineCap:n.lineCap||"butt",lineJoin:n.lineJoin||"round"}};p(n,s);break;case"rect":var v=n.x||0,y=n.y||0,w=n.width||0,b=n.height||0;s={vectorType:0,pointsList:[{x:v,y:y},{x:v+w,y:y},{x:v+w,y:y+b},{x:v,y:y+b},{x:v,y:y}],style:{}};p(n,s);break;case"text":var v=n.x||0,y=n.y||0,w=n.width||0,b=n.height||0;s={vectorType:3,text:l.VectorImageTemplate.placeholderText,anchor:{x:v+w/2,y:y+b/2},maxWidth:w,leftTop:{x:v,y:y},rightBottom:{x:v+w,y:y+b},style:{fillStyle:r(n.fill,f,o),font:"".concat(n.fontFamily||l.VectorImageTemplate.defaultFont," ").concat(f.getFontFallback()),fontStyle:a(n.fontWeight),fontSize:n.fontSize||0,horizontalAutoScaling:1,verticalAlignment:1},fillStylePaletteKey:t(n.fill)}}return s&&(s.scale=h(n.scale,f,o),s.scalePaletteKey=t(n.scale),s.shapePaletteKey=i),s}function u(n,t,i,r,u){var e=t.layers[i],o;e&&e.records&&(o=e.shape,n.push.apply(n,e.records.map(function(n){return f(n,o,t.defs,r,u)})))}function v(n,t,i,r,u){var c,l,b,e;if(!n||!n.layers||!n.layers.background&&!n.layers.icon)return n;var k=n.defs,a,v,h=n.layers.background,f=n.layers.icon,y=n.anchorX,p=n.anchorY,d=i||!t.some(function(n){return n.endsWith("Price")}),w=h&&h.shape;if(w){var g=r.getStringPaletteValue(w,t),nt=r.getShapeImageId(g),s=u.getImageById(nt);s&&s.layers&&(h=s.layers.background,a=s.defs,s.overrideAnchor&&(y=s.anchorX,p=s.anchorY))}if(l=f&&f.shape,l&&d){var tt=r.getStringPaletteValue(l,t),it=r.getShapeImageId(tt),e=u.getImageById(it);e&&(v=e.defs,e.records?f={records:e.records,shape:f.shape}:e.layers&&(f=e.layers.icon))}return!i||f&&((c=f.records)===null||c===void 0?void 0:c.some(function(n){return n.type==="text"}))||(b=r.getShapeImageId("text"),e=u.getImageById(b),e&&e.layers&&(f=e.layers.icon)),(h||f)&&(n={anchorX:y,anchorY:p,layers:{background:JSON.parse(JSON.stringify(h)),icon:JSON.parse(JSON.stringify(f))},defaultEntry:n.defaultEntry,defs:o(o(o({},k),a),v)}),n}function y(n,t,i,r,u){var l,d,a,g;if(!n||!n.layers||!n.layers.background&&!n.layers.icon)return Promise.resolve(n);var nt=n.defs,v,y,h=n.layers.background,f=n.layers.icon,p=n.anchorX,w=n.anchorY,tt=i||!t.some(function(n){return n.endsWith("Price")}),b=h&&h.shape,k=f&&f.shape,e,s,c=[];return b&&(l=r.getStringPaletteValue(b,t),d=r.getShapeImageId(l),d&&c.push(u.getBaseMapShape(l).then(function(n){return e=n,n}))),k&&tt&&(a=r.getStringPaletteValue(k,t),g=r.getShapeImageId(a),g&&c.push(u.getBaseMapShape(a).then(function(n){return s=n,n}))),Promise.all(c).then(function(){var t,r;return e&&e.layers&&(h=e.layers.background,v=e.defs,e.overrideAnchor&&(p=e.anchorX,w=e.anchorY)),s&&(y=s.defs,s.records?f={records:s.records,shape:f.shape}:s.layers&&(f=s.layers.icon)),r=!i||f&&((t=f.records)===null||t===void 0?void 0:t.some(function(n){return n.type==="text"}))?Promise.resolve():u.getBaseMapShape("text").then(function(n){n&&n.layers&&(f=n.layers.icon)}),r.then(function(){return(h||f)&&(n={anchorX:p,anchorY:w,layers:{background:JSON.parse(JSON.stringify(h)),icon:JSON.parse(JSON.stringify(f))},defaultEntry:n.defaultEntry,defs:o(o(o({},nt),v),y)}),n})})}function p(n,t,r,e,o,s){var h=[],a=n.defaultEntry,c,l;return t=t||[],a&&(t=t.concat(a)),i.prefetchTemplateShapes?(n&&n.layers?(n=v(n,t,r,e,o),u(h,n,"background",e,t),u(h,n,"icon",e,t)):n&&n.records&&h.push.apply(h,n.records.map(function(i){return f(i,undefined,n.defs,e,t)})),c=void 0,h&&h.length&&(c={hotspotX:n.anchorX,hotspotY:n.anchorY,overrideHotspot:n.overrideAnchor||!1,records:h}),Promise.resolve(c)):(l=Promise.resolve(n),n&&n.layers?l=y(n,t,r,e,s).then(function(n){return u(h,n,"background",e,t),u(h,n,"icon",e,t),n}):n&&n.records&&h.push.apply(h,n.records.map(function(i){return f(i,undefined,n.defs,e,t)})),l.then(function(n){return h&&h.length?{hotspotX:n.anchorX,hotspotY:n.anchorY,overrideHotspot:n.overrideAnchor||!1,records:h}:undefined}))}n.imageFromBaseMap=p})(r||(r={})),function(t){function r(n,t,i,r){return"".concat(n,"_").concat(i?"b":"a").concat(t,"_").concat(r)}function u(n,t){return"".concat(n,"_").concat(t)}var f=function(){function t(){function t(t){return n._updateTfeUrlDomain(t.replace("{urlbase}",i.styleUrlBase)).replace("{stlVersion}",a.stlVersion).replace("{odmgenid}",u).replace("{lang}",r.uiLanguage)}this._images={};this._imageIds={};this._orgImages={};this._shieldImages={};this._shieldBucketToAdmin={};var r=a.dynamicProperties,u=r.compositionHandlerGenerationId;this._imageUrlFormat=t(i.imageUrlFormat);this._orgImageUrlFormat=t(i.orgImageUrlFormat);this._shieldBucketImageUrlFormat=t(i.shieldBucketImageUrlFormat);this._shieldAdminImageUrlFormat=t(i.shieldAdminImageUrlFormat)}return t.prototype.getImageById=function(n){return this._images[n]},t.prototype.getImageByGroupId=function(n,t){var i=this._imageIds[u(n,t)];return this._images[i]},t.prototype.getOrgImageById=function(n){return this._shieldImages[n]},t.prototype.getShieldByBucket=function(n,t,i){var u=this._shieldBucketToAdmin[t];return this._shieldImages[r(n,u||t,!u,i)]},t.prototype.getShieldByAdminDivision=function(n,t,i){return this._shieldImages[r(n,t,!1,i)]},t.prototype.prefetchImages=function(n,t,r,u,f){var a=this,e,o,c,h,l,s;if(i.batchPrefetchImages){for(this._batches||(this._batches={},d.setTimeout(function(){return a._executeBatches()},25)),e=this._batches[n]=this._batches[n]||{imageIds:new Set,imageGroupIds:new Set,successCallbacks:[],errorCallbacks:[]},o=0,c=t||[];o<c.length;o++)s=c[o],e.imageIds.add(s);for(h=0,l=r||[];h<l.length;h++)s=l[h],e.imageGroupIds.add(s);e.successCallbacks.push(u);e.errorCallbacks.push(f)}else this._prefetchImages(n,t,r,u,f)},t.prototype._executeBatches=function(){var i=this._batches||{},r,u,n,t,f;for(this._batches=null,r=function(n){var t=i[n];u._prefetchImages(n,Array.from(t.imageIds),Array.from(t.imageGroupIds),function(){for(var r,n=0,i=t.successCallbacks;n<i.length;n++)r=i[n],r()},function(){for(var r,n=0,i=t.errorCallbacks;n<i.length;n++)r=i[n],r()})},u=this,n=0,t=Object.keys(i);n<t.length;n++)f=t[n],r(f)},t.prototype._prefetchImages=function(n,t,i,r,u){var o=this,f,e;t=(t||[]).sort(function(n,t){return n-t});i=(i||[]).sort(function(n,t){return n-t});f=(t.length?t[0]:i[0])%2;e=this._imageUrlFormat.replace("{imageFamily}",n).replace("{imageId}",t.join(",")).replace("{groupId}",i.join(",")).replace("{subdomain}",(isNaN(f)?0:f)+"");y.downloadJson(e,"xsrimages",function(t){o._parseResponse(n,t);r&&r()},u,null,!1,0,!1)},t.prototype.fetchOrgImage=function(n,t,i){var r=this,u=this._orgImageUrlFormat.replace("{orgId}",n).replace("{subdomain}","0");y.fetchGeneric(u,"xsrorgid",function(u){var f=u.headers.get("content-type");(f===null||f===void 0?void 0:f.startsWith("image"))?u.blob().then(function(n){var r=new Image;r.onload=function(){URL.revokeObjectURL(r.src);r.onload=null;t(r)};r.onerror=i;r.src=URL.createObjectURL(n)}).catch(function(){i()}):u.json().then(function(i){var u=i[n];r._orgImages[n]=u;t(u)}).catch(function(){i()})},i)},t.prototype.fetchShield=function(n,t,i,u,f,e){var o=this,s=(t?this._shieldBucketImageUrlFormat:this._shieldAdminImageUrlFormat).replace("{imageFamily}",n).replace("{shieldId}","".concat(i,":").concat(u)).replace("{subdomain}","0");y.downloadJson(s,"xsrshield",function(e){var s,l=e.bktAdminDiv;if(l){var h=e.bktAdminDiv||[i,i],a=h[0],c=h[1];o._shieldBucketToAdmin[a]=c;s=r(n,c,!1,u)}else s=r(n,i,t,u);o._shieldImages[s]=e;f&&f(e)},e,null,!1,0,!1)},t.prototype._parseResponse=function(n,t){var i,r,f,o,s,e,h,c;for(t.imageGroupMap?(i=t.imageGroupMap,r=t.images):r=t,f=0,o=Object.keys(r);f<o.length;f++)s=o[f],this._images[s]=r[s];if(i)for(e=0,h=Object.keys(i);e<h.length;e++)c=h[e],this._imageIds[u(n,c)]=i[c]},t}();t.BaseMapImageLoader=f}(r||(r={})),function(t){function u(n,t){var r=n===null||n===void 0?void 0:n.split("-"),l=r===null||r===void 0?void 0:r.length,f=t===null||t===void 0?void 0:t.templateSelector,h=r[0]==="shield",e,u,o,s,c;if(f&&!(l<2)&&!t.landmarkImageIds[n]){if(r[0]==="oid")e=f.getOrganizationImage(r[1]);else if(h)e=f.getShieldIconTemplate(!1,parseInt(r[1]),parseInt(r[2]));else{u=void 0;switch(r[0]){case"bkt":u=2;break;case"hov":u=3;break;case"hovret":u=7;break;case"ret":u=5}u&&(e=f.getPoiTemplate(r[1],u,0,5,!1,null,null,!0))}e&&(o=t.images,s=t.landmarkImageIds,i.styleImagePlaceholders&&o.addImage("BingMapStyle",n,{icon:{width:0,height:0,data:new Uint8ClampedArray(0)},metadata:{},anchor:"center",offset:new ot(0,0)}),s[n]=1,l===4&&r[2]==="coupoi"&&p.landmarkDeals&&(c=f.getShape(r[3])),e.then(function(t){var u,f;return t instanceof HTMLImageElement?(s[n]=2,{icon:t,metadata:{pixelRatio:1},anchor:"bottom",offset:[0,0],padding:{left:0,top:0,right:0,bottom:0}}):(u=null,h&&(f=parseInt(r[3])||1,u="0".repeat(f)),t.renderIconWithMetadata(u,!h,i.iconOversample))}).then(function(n){return c?c.then(function(t){return k.addBadgeTemplate(n,t)}):n}).then(function(t){s[n]&&(i.styleImagePlaceholders||o.getImageRecord(n)?o.updateImage(n,t):o.addImage("BingMapStyle",n,t))}))}}function f(n,t){var i,u,r;if(n&&t)for(i=0,u=Object.keys(n);i<u.length;i++)r=u[i],n[r]===1&&(t.removeImage(r),delete n[r])}function e(i){var e=i===null||i===void 0?void 0:i.clientProperties,c;if(e&&!e.images){var o=new t.MapImageRepository(i),s=new t.PrimitiveLayerManager(i),h=new t.MapTemplateSelector(i,s);return e.images=o,e.layerManager=s,e.templateSelector=h,e.landmarkState=2,e.landmarkImageIds={},c=[o,s,h,b.add(i,"stylechanged",function(){f(e.landmarkImageIds,o);var n=e.landmarkState;n!==2&&(delete e.landmarkState,r(i,n));o&&o.refreshImages()}),b.add(i,"styleimagemissing",function(n){u(n,e)})],{dispose:function(){n._clearDisposables(c);e.images=null;e.layerManager=null;e.templateSelector=null;e.landmarkImageIds={}}}}return{dispose:function(){}}}function o(n){var t;if((t=n===null||n===void 0?void 0:n.clientProperties)!==null&&t!==void 0)return t.images}function s(n){var t;if((t=n===null||n===void 0?void 0:n.clientProperties)!==null&&t!==void 0)return t.layerManager}function h(n){var t;if((t=n===null||n===void 0?void 0:n.clientProperties)!==null&&t!==void 0)return t.templateSelector}function r(n,t){var e=n===null||n===void 0?void 0:n.clientProperties,l,r,h,f,c,u;if(e&&(l=e.landmarkState,l!==t)){e.landmarkState=t;var o=n._getMap(),s=o.getStyle().metadata,i=s===null||s===void 0?void 0:s.layerIndex,a=i===null||i===void 0?void 0:i.defaultBusinessLandmarks,v=i===null||i===void 0?void 0:i.retiredBusinessLandmarks,y=t===2?a:v,p=t===2?v:a;if(y&&p){for(r=0,h=y;r<h.length;r++)u=h[r],o.setLayoutProperty(u,"visibility","visible");for(f=0,c=p;f<c.length;f++)u=c[f],o.setLayoutProperty(u,"visibility","none")}}}t.init=e;t.getImages=o;t.getLayerManager=s;t.getTemplateSelector=h;t.setLandmarksState=r}(r||(r={}));s=function(){function t(n,t){if(n instanceof Array)this._populateColorComponents(n);else switch(t){case 1:case 2:this._parseHex(n,t);break;case 0:this._parseRgba(n);break;case 3:this._unpackColor(n);break;case 4:this._parseHsla(n)}}return t.parse=function(n,i){var u,r=t._getColorFormat(n);return r!==undefined?(r===1&&i===2&&(r=2),u=new t(n,r)):u=t._parseViaBrowser(n),u},t.areEqual=function(n,t){return n.red===t.red&&n.green===t.green&&n.blue===t.blue&&n.alpha===t.alpha},t.prototype.blend=function(i){function o(n,t,i){return(1-s)*t+s*Math.floor((1-f)*n+f*i)}var r=i,u=i.alpha,f=this.alpha,e=u+f*(1-u),s=u/e;e<=0&&this._parseRgba(t.transparent);this._populateColorComponents([n._clamp(o(i.red,this.red,r.red),0,255),n._clamp(o(i.green,this.green,r.green),0,255),n._clamp(o(i.blue,this.blue,r.blue),0,255),n._clamp(e,0,1)])},t.prototype.toPacked=function(){return((this.alpha*255&255)<<24>>>0)+((this.red&255)<<16)+((this.green&255)<<8)+(this.blue&255)},t.prototype.toRgba=function(){return this.alpha<1?"rgba("+this.red+","+this.green+","+this.blue+","+n.roundToInterval(this.alpha,.01)+")":"rgb("+this.red+","+this.green+","+this.blue+")"},t._getColorFormat=function(n){var i;return n=n||"",n[0]!=="#"||n.length!==7&&n.length!==9||isNaN(parseInt(n.slice(1),16))?n.match(t.rgbRegex)?i=0:n.match(t.hslRegex)&&(i=4):i=1,i},t._parseViaBrowser=function(n){var u,i,r;return n&&(i=document.createElement("div"),r=document.body,i.style.display="none",i.style.color=n,i.style.color&&(r.appendChild(i),n=getComputedStyle(i).color,r.removeChild(i),n&&n.match(t.rgbRegex)&&(u=new t(n,0)))),u},t.prototype._parseHex=function(n,t){var i=parseInt(n.slice(1),16);n.length===9?t===2?this.alpha=(i>>24&255)/255:(this.alpha=(i&255)/255,i=i>>8):this.alpha=1;this.red=i>>16&255;this.green=i>>8&255;this.blue=i&255},t.prototype._parseHsla=function(n){var u=n&&n.match&&n.match(t.hslRegex);if(u&&u.length>4){var i=u.slice(1).map(function(n){return parseFloat(n)}),e=i[0],o=i[1],s=i[2],f=i[3],r=ut.hslaTorgba(e/360,o/100,s/100,isFinite(f)?f:1);this.red=r.red;this.green=r.green;this.blue=r.blue;this.alpha=r.alpha}},t.prototype._parseRgba=function(n){var i=n&&n.match&&n.match(t.rgbRegex);i&&i.length>4&&this._populateColorComponents(i.slice(1))},t.prototype._populateColorComponents=function(n){n&&n.length>=3&&(this.red=parseInt(n[0]),this.green=parseInt(n[1]),this.blue=parseInt(n[2]),this.alpha=n.length>3&&n[3]!==undefined?parseFloat(n[3]):1)},t.prototype._unpackColor=function(t){var i=parseInt(t);this.red=i>>16&255;this.green=i>>8&255;this.blue=i&255;this.alpha=n.roundToInterval((i>>24&255)/255,.01)},t.transparent="rgba(255, 255, 255, 0.0)",t.white="rgb(255, 255, 255)",t.black="rgb(0, 0, 0)",t.hslRegex=/hsla?\((\d+),\s*(\d+)%,\s*(\d+)%(?:,\s*(\d+(?:\.\d+)?))?\)$/,t.rgbRegex=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/,t}();ut=function(){function n(){}return n.getComponent=function(n,t,i){return n<1/6?t+(i-t)*6*n:n<.5?i:n<2/3?t+(i-t)*6*(2/3-n):t},n.normalize=function(n){return n<0&&(n+=1),n>1&&(n-=1),n},n.clamp=function(n,t,i){return n<t?t:n>i?i:n},n.applyHslaTransform=function(t,i){var r=t.x+i.x;r>1&&(r-=1);var u=n.clamp(t.y+i.y,0,1),f=n.clamp(t.z+i.z,0,1),e=n.clamp(t.w+i.w,0,1);return{x:r,y:u,z:f,w:e}},n.hslaTorgba=function(t,i,r,u){var f=r<.5?r*(1+i):r+i-r*i;var e=2*r-f,o=n.getComponent(n.normalize(t+1/3),e,f),h=n.getComponent(n.normalize(t),e,f),c=n.getComponent(n.normalize(t-1/3),e,f);return new s([n.clamp(Math.round(o*255),0,255),n.clamp(Math.round(h*255),0,255),n.clamp(Math.round(c*255),0,255),n.clamp(u,0,1)])},n.convertPackedTorgba=function(n){var t=new s(n,3);return t.toRgba()},n}(),function(t){function r(n){var i,t;return n instanceof atlas.Shape?(t=n.dataSource,i=t===null||t===void 0?void 0:t.getId()):i=n.source,i}function u(n){return i.getInstance(n)}var i=function(){function i(n){this._map=n;this.handlerId="HitTestManager";var t=new ht.BaseMapFeatureDelegate(n);t.registerGlobalHandler(this);this._managers=[]}return i.getInstance=function(n){var r=n.clientProperties,t=r.hitTestManager;return t||(t=new i(n),r.hitTestManager=t),t},i.prototype.dispose=function(){this.isDisposed||(n._nullifyClass(this),this.isDisposed=!0)},i.prototype.areSameFeatureInfo=function(n,i){return(n===null||n===void 0?void 0:n.primitive)&&(i===null||i===void 0?void 0:i.primitive)&&t.arePrimitivesEqual(n.primitive,i.primitive)},i.prototype.getFeatureInfo=function(n,t){var i=this._getAffectedPrimitiveData(n,t);if(i){var r=i.primitive,f=i.manager,u=1;return r.geometry.geometryType===3?u=5:r.primitiveType===12&&(u=4),{priority:u,primitive:r,manager:f}}return undefined},i.prototype.clickFeature=function(n,t,i){var r=n.primitive,u=!1;return r.isClickEnabled!==!1&&(n.manager.clickPrimitive(r,t,i),u=!0),u},i.prototype.enterFeature=function(n,t){n.manager.hoverPrimitive(n.primitive,t,!0)},i.prototype.hoverFeature=function(n,t){n.manager.primitiveHovering.invoke({primitive:n.primitive,event:t})},i.prototype.leaveFeature=function(n,t){n.manager.hoverPrimitive(n.primitive,t,!1)},i.prototype.dragFeature=function(n,t,i){n.manager.dragPrimitive(n.primitive,t,i)},i.prototype.getAffectedPrimitive=function(n){var t=this._getAffectedPrimitiveData(n);return t&&t.primitive},i.prototype.registerPrimitiveManager=function(n){this._managers.push(n)},i.prototype.unregisterPrimitiveManager=function(n){var t=this._managers.indexOf(n);t>=0&&this._managers.splice(t,1)},i.prototype._getAffectedPrimitiveData=function(n,i){for(var h,f,e=n&&n.shapes||[],o={},c=function(n){var f=r(n),p,s,c,w,a,h,v,y,u;if(!f||o[f])return"continue";for(o[f]=!0,p=e.filter(function(n){var t=r(n);return f===t}).sort(function(n,t){var i=n instanceof atlas.Shape?n.getProperties():n===null||n===void 0?void 0:n.properties,r=t instanceof atlas.Shape?t.getProperties():t===null||t===void 0?void 0:t.properties;return((r===null||r===void 0?void 0:r.symbolDrawOrder)||0)-((i===null||i===void 0?void 0:i.symbolDrawOrder)||0)}),s=0,c=p;s<c.length;s++)if(w=c[s],a=t.PrimitiveManager.getPrimitiveId(w),a)for(h=0,v=l._managers;h<v.length;h++)if(y=v[h],u=y.getManagedPrimitive(a),u&&u.isHoverEnabled!==!1&&(!i||u.isDragEnabled))return{value:{primitive:u,manager:y}}},l=this,u=0,s=e;u<s.length;u++)if(h=s[u],f=c(h),typeof f=="object")return f.value;return null},i}();t.HitTestManager=i;t.getHitTestManager=u}(r||(r={})),function(t){var i=function(){function t(n){var t=this;this._map=n._getMap();this._images=new Map;this._imagePromises=new Map;this._owners=new Map;this._unreferencedImages=new yt(20,function(n){t._removeImageData(n)})}return t.prototype.addImage=function(n,t,i){var u,r;return this._images?(r=this.getImageRecord(t),r||(r={result:i,owners:new Set},this._map.addImage(t,i.icon,i.metadata),this._images.set(t,r)),u=this.addReference(n,t),this._resolvePromise(t,i)):u=Promise.reject(),u},t.prototype.addReference=function(n,t){var f,u,i,r;if(this._images){if(u=this._images.get(t),u)return u.owners.add(n),i=this._owners.get(n),i||(i=new Set,this._owners.set(n,i)),i.add(t),this._unreferencedImages.removeItem(t,!1),Promise.resolve(u.result);r=this._imagePromises.get(t);r||(r=new vt,this._imagePromises.set(t,r));f=r}else f=Promise.reject();return f},t.prototype.clear=function(){var n=this;this._images&&(this._unreferencedImages.clear(),this._images.forEach(function(t,i){n._removeImageData(i)}),this._images.clear(),this._imagePromises.clear(),this._owners.clear())},t.prototype.getImageIds=function(){return this._images&&this._images.keys()},t.prototype.getImageRecord=function(n){return this._images&&this._images.get(n)},t.prototype.refreshImages=function(){var n=this._map;n&&this._images.forEach(function(t,i){if(!n.hasImage(i)){var r=t.result;n.addImage(i,r.icon,r.metadata)}})},t.prototype.removeAllReferences=function(n){var i=this,t=this._owners&&this._owners.get(n);t&&(t.forEach(function(t){i.removeReference(n,t)}),this._owners.delete(n))},t.prototype.removeReference=function(n,t){var r=this._owners&&this._owners.get(n),i=this._images&&this._images.get(t);r&&i&&(r.delete(t),i.owners.delete(n),i.owners.size||this._unreferencedImages.addItem(t,!0))},t.prototype.removeImage=function(n){var u=this,t,i=(t=this._images)===null||t===void 0?void 0:t.get(n),r;i&&(r=i.owners,r.forEach(function(t){var i=u._owners.get(t);i===null||i===void 0?void 0:i.delete(n)}),this._removeImageData(n))},t.prototype.updateImage=function(n,t){if(this._images){var i=this.getImageRecord(n);i&&(i.result=t,this._map.removeImage(n),this._map.addImage(n,t.icon,t.metadata))}},t.prototype.hasImage=function(n){return this._images&&this._images.has(n)},t.prototype.dispose=function(){this.clear();n._nullifyClass(this)},t.prototype._removeImageData=function(n){this._map&&(this._map.removeImage(n),this._images.delete(n),this._imagePromises.delete(n))},t.prototype._resolvePromise=function(n,t){if(this._imagePromises){var i=this._imagePromises.get(n);i&&(i.resolve(t),this._imagePromises.delete(n))}},t}();t.MapImageRepository=i}(r||(r={})),function(t){function e(n,t,i){if(t){i=i||t;var r=n.getBounds().getSize();r.width&&r.height&&n.setScale(Math.min(t/r.width,i/r.height))}}var h="90000",u,r,c={"13344":"91572","90298":"91257","90375":"90386","90628":"90727","90948":"91562","90975":"90977","91485":"90661","91563":"90940","91826":"90012","100000":"203",EatAndDrink:"90287",EatAndDrinkOpalScenario:"90287",WhatToDo:"90012",WhatToDoOpalAction:"90012",WhereToStay:"91572",WhereToStayOpalAction:"91572",Attraction:"90012",Campground:"91562",MovieTheatre:"90045",Parking:"90925",Trail:"90012",School:"90199",University:"90199",TestingLocation:"90386"},v={House:{categoryId:-1,bucketId:1942,entry:""},Event:{categoryId:-1,bucketId:1966,entry:""},Events:{categoryId:-1,bucketId:1966,entry:""},PivotEntity:{categoryId:-1,bucketId:353,entry:""},"90000":{categoryId:9e4,bucketId:334,entry:"Business"}},f={},o;(function(){for(var i,n=0,t=["50","64","65","226","227","228","229","231","232","234","235","236","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","1899"];n<t.length;n++)i=t[n],f[i]=!0})();var w=["","Point","Line","Area",],k=[[""],[""],["default{GeometryType}State"],["hover{GeometryType}State"],["selected{GeometryType}State"],["inactive{GeometryType}State"],["inactiveSelected{GeometryType}State"],["inactiveHover{GeometryType}State","inactive{GeometryType}State","hover{GeometryType}State"],],g=["","Search","Price","Itinerary","ShowMe","Landmark","Transit","","","TrafficIncident","Classic","","Search","","","TrafficCamera",];o=function(){function o(r,u){var h=this,o;this._map=r;this._layerManager=u;this._stlVersion=a.stlVersion;this._imageLoader=new t.BaseMapImageLoader;this._palette=new t.Palette;var s=a.dynamicProperties,f=s.compositionHandlerGenerationId,e=i.styleUrlBase;this._catMapUrlFormat=n._updateTfeUrlDomain(i.catMapUrlFormat.replace("{urlbase}",e)).replace("{stlVersion}",this._stlVersion).replace("{ctpVersion}",a.ctpVersion.toString()).replace("{odmgenid}",f).replace("{subdomain}","0");this._sharedStyleUrlFormat=n._updateTfeUrlDomain(i.sharedStyleUrlFormat.replace("{urlbase}",e)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",f).replace("{subdomain}","0");this._coreStyleUrlFormat=n._updateTfeUrlDomain(i.coreStyleUrlFormat.replace("{urlbase}",e)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",f).replace("{subdomain}","0").replace("{lang}",s.uiLanguage);o=n.getMapStyle(r);this._templateName=o.mapStyleId;this._templateTheme=o.theme;this._disposables=[b.add(r,"stylechanged",function(){return h._onMapStyleChanged(r)})];this.selectorReady()}return o.prototype.dispose=function(){this.isDisposed||(n._clearDisposables(this._disposables),n._nullifyClass(this),this.isDisposed=!0)},o.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t,i){var r=[n._initCategoryMap(),n._initTemplateData()];Promise.all(r).then(function(){n._initialized=!0;t(n)},function(){n._ready=null;i(null)})})),this._ready},o.prototype.extractCategoryId=function(n,t){var r,i;for(n=n||"",r=n.split("."),i=r.length-1;i>=0;i--)if(this.getBucketForCategory(r[i]))return r[i];return t?h:null},o.prototype.getBucketForCategory=function(n,t){var u,i;return r&&(i=r[n]||r[c[n]]||v[n],u=i&&i.bucketId.toString()),u||(t?"334":"")},o.prototype.getPaletteKeyForBucket=function(n){var t;return((t=this._palette)===null||t===void 0?void 0:t.getBucketEntry(n))||""},o.prototype._getPrimitiveStateNames=function(n,t){for(var e,r,u=[],o=k[t]||[],i=0,f=o;i<f.length;i++)e=f[i],r=(e||"").replace("{GeometryType}",w[n]||""),r&&u.push(r);return u},o.prototype.getIconTemplate=function(n,t,i,r,u,f){var h=this,o,c;n&&(o=5,c=this.getPrimitiveTypeStateNames(1,2,o),this._getImageTemplate(t,c,o,12,!1).then(function(o){var a=o&&o.getVectorImage(),nt=null,v,y,b,g;if(a){var p="",tt={hotspotX:a.hotspotX,hotspotY:a.hotspotY,records:[]},w=h._palette,it=w.getBucketEntry(t);for(it&&(v=h._searchInvertsColors,w.invertedIcons[t]&&(v=!v),p=w.getColorPaletteValue(v?"iconColor":"fillColor",[it])),y=0,b=a.records;y<b.length;y++){var k=b[y],rt=JSON.parse(JSON.stringify(k)),c=rt.style;tt.records.push(rt);i||(k.shapePaletteKey&&k.shapePaletteKey.endsWith("shape-background")?c.fillStyle=c.strokeStyle=s.transparent:(c.fillStyle=r||p,c.strokeStyle=s.transparent),c.fillGradient=c.strokeGradient=null)}g=new l.VectorImageTemplate(tt);e(g,u,f);nt={icon:g,iconColor:p}}d.setAsync(function(){n(nt)})}))},o.prototype.getShieldIconTemplate=function(n,t,i,r,u){return n&&(t=t>>16),this._getShieldImageTemplate(n,t,i).then(function(n){return e(n,r,u),n})},o.prototype.getOrganizationImage=function(n){var t=this;return this.selectorReady().then(function(){return new Promise(function(i,r){var u=t._imageLoader.getOrgImageById(n);u?i(t._imageToTemplate(u)):t._imageLoader.fetchOrgImage(n,function(n){n instanceof HTMLImageElement?i(n):i(t._imageToTemplate(n))},r)})})},o.prototype.getBaseMapShape=function(n){var t=this;return this.selectorReady().then(function(){var r=t._palette.getShapeImageId(n),i;return r?(i=t._imageLoader.getImageById(r),i)?Promise.resolve(i):new Promise(function(n,u){t._imageLoader.prefetchImages(t._imageFamily,[r],null,function(){i=t._imageLoader.getImageById(r);i?n(i):u()},u)}):Promise.resolve(null)})},o.prototype.getShape=function(n){var t=this;return this.getBaseMapShape(n).then(function(n){return t._imageToTemplate(n)})},o.prototype.getPoiTemplate=function(n,t,i,r,u,e,o,s){var c=this,h;return r===void 0&&(r=1),r===5&&f[n]&&(r=6),h=this._getPrimitiveStack(1,r,t,e,o),r===3?h.push("ItineraryPoint"):(r===1||r===4)&&this._palette.invertedIcons[n]&&this._searchInvertsColors&&h.push("iconColorInverted"),n||e||(n="334"),this._getImageTemplate(n,h,r,i,u).then(function(t){var f,i,r,u;return h.push(c.getPaletteKeyForBucket(n)),f=c._palette.getBooleanPaletteValue("shadowVisible",h),i=t.shadowStyle,f&&i&&(r=c._palette.getColorPaletteValue("shadowColor",["global"]),r&&(i.shadowColor=r,i.shadowBlur=c._palette.iconShadowBlur,i.shadowOffset=c._palette.iconShadowOffset)),s&&(u=c._palette.getNumericPaletteValue("scale",h),u>0&&t.setScale(u)),t})},o.prototype.getLayerOptions=function(n){var t=JSON.parse(JSON.stringify(this._palette.getLayerOptions(n)));return p.simpleIcon&&(t.label&&(t.label.textOptions={}),t.iconAndLabel&&(t.iconAndLabel.textOptions={})),t},o.prototype.getTemplateName=function(){return this._templateName},o.prototype.isDarkTheme=function(){return this._templateTheme==="dark"},o.prototype.setFeatureStyleProps=function(n,t){this.setFeatureStyleProperties(t,n.geometry.geometryType,n.state,n.bucket,n.primitiveType,n.stylesheetEntry,n.stylesheetEntryState)},o.prototype.setFeatureStyleProperties=function(n,t,i,r,u,f,e){var l,p,a,w,v,b,o;u===void 0&&(u=1);var s=this._getPrimitiveStack(t,u,i,f,e),h=this._palette,k=h.getBucketEntry(r);k&&s.push(k);var y=["labelColor","labelOutlineColor"],c=["labelScale"];for(t===2?(y.push("fillColor","strokeColor"),c.push("strokeWidthScale")):t===3?(y.push("fillColor","borderOutlineColor","borderStrokeColor"),c.push("borderWidthScale")):t===1&&c.push("scale"),l=0,p=y;l<p.length;l++)o=p[l],n[o]=h.getColorPaletteValue(o,s);for(a=0,w=c;a<w.length;a++)o=w[a],n[o]=h.getNumericPaletteValue(o,s);for(v=0,b=["fontFamily","fontWeight"];v<b.length;v++)o=b[v],n[o]=h.getStringPaletteValue(o,s);n.layerStyle=h.getBucketLayerStyle(r,s)},o.prototype._getPrimitiveStack=function(n,t,i,r,u){var f=this.getPrimitiveTypeStateNames(n,i,t);return u&&f.push.apply(f,u.split(";")),r&&f.push(r),f},o.prototype._getImageById=function(n){return this._imageLoader.getImageById(n)},o.prototype._getImageByBucket=function(n){var t=this._palette.getBucketImageGroupId(n);return t&&this._imageLoader.getImageByGroupId(this._imageFamily,t)},o.prototype._getImageTemplate=function(n,i,r,u,f){var e=this;return this.selectorReady().then(function(){return e._fetchImages([n])}).then(function(){var r=e._getImageByBucket(n);return r?t.imageFromBaseMap(r,i,f,e._palette,e._imageLoader,e):null}).then(function(n){return n?new l.VectorImageTemplate(n):null})},o.prototype._imageToTemplate=function(n){return t.imageFromBaseMap(n,[],!1,this._palette,this._imageLoader,this).then(function(n){return new l.VectorImageTemplate(n)})},o.prototype._getShieldImageTemplate=function(n,t,i){var r=this;return this.selectorReady().then(function(){return new Promise(function(u,f){var e=n?r._imageLoader.getShieldByBucket(r._imageFamily,t,i):r._imageLoader.getShieldByAdminDivision(r._imageFamily,t,i);e?u(r._imageToTemplate(e)):r._imageLoader.fetchShield(r._imageFamily,n,t,i,function(n){u(r._imageToTemplate(n))},f)})})},o.prototype.getPrimitiveTypeStateNames=function(n,t,i){var r=this._getPrimitiveStateNames(n,t),f=g[i],u;if(f&&r&&r.length)for(u=0;u<r.length;u++)r[u]=r[u]+f;return r.length>1&&(this._palette.paletteElementExists(r[0])?r.length=1:r.shift()),r},o.prototype._fetchImages=function(n,t,i,r){var u=this;return r===void 0&&(r=3),n=n||[],t=t||[],new Promise(function(f){if(i||(n=n.filter(function(n){return!u._getImageByBucket(n)}),t=t.filter(function(n){return!u._getImageById(n)})),n.length||t.length){var e=n.map(function(n){return u._palette.getBucketImageGroupId(n)}).filter(function(n){return!!n});u._imageLoader.prefetchImages(u._imageFamily,t,e,function(){f()},function(){f();r>0&&d.setTimeout(function(){u.isDisposed||u._fetchImages(n,t,i,--r)},200)})}else f()})},o.prototype._initCategoryMap=function(){var n=this;return u||(u=this._catMapUrlFormat?new Promise(function(t){y.downloadJson(n._catMapUrlFormat,"catmap",function(i){n._onCatMapResponse(i);t(null)},function(){t(null)},null,!1,null,!1)}):Promise.resolve(null)),u},o.prototype._onCatMapResponse=function(n){var i,t,f,u;if(!this.isDisposed&&n)for(i=n.categoryMap||[],r={},t=0,f=i.length;t<f;t++)u=i[t],r[u.categoryId]=u},o.prototype._initTemplateData=function(){var t=this,n=this._templatePromise;return n||(n=new Promise(function(n,i){t._requestTemplateData(n,i)}),this._templatePromise=n),n},o.prototype._requestTemplateData=function(t){var r=this;this._palette.initCoreStyle(this._sharedStyleUrlFormat,this._coreStyleUrlFormat,this._templateName).then(function(){var t,u,f;return(r._layerManager&&r._layerManager.setLayerStyleOrder(r._palette.getLayerStyleOrder()),t=r._palette.xsrVersion,u=i.xsrVersionMap[i.searchInvertsColorVersion],r._searchInvertsColors=n.compareVersions(t,u)<0,r._imageFamily=r._palette.getImageFamily(),f=et(["text"],r._palette.getReferencedShapes(),!0),i.prefetchTemplateShapes)?r._fetchImages([],f.map(function(n){return r._palette.getShapeImageId(n)}),!0):null}).then(function(){t()})},o.prototype._onMapStyleChanged=function(t){var i=n.getMapStyle(t),r=i.mapStyleId;r!==this._templateName&&(this._templateTheme=i.theme,this._templateName=r,this._ready=null,this._templatePromise=null,this.selectorReady())},o}();t.MapTemplateSelector=o}(r||(r={})),function(t){var i,r=function(){function t(){}return t.prototype._loadSharedStyle=function(n){return i||(i=new Promise(function(i,r){y.downloadJson(n,"sharedstyle",function(n){t._sharedStyle=n;i()},function(){r()},null,!1,null,!1)})),i},t.prototype.initCoreStyle=function(n,t,i){if(!this._coreStylePromise||this._templateName!==i){var r=[this._loadSharedStyle(n),this._loadCoreStyle(t,i)];this._coreStylePromise=Promise.all(r).then()}return this._coreStylePromise},t.prototype._loadCoreStyle=function(n,t){var i=this,r=n.replace("{templateName}",t);return new Promise(function(n,t){y.downloadJson(r,"corestyle",function(t){i._parseCoreStyle(t).then(function(){return n()})},function(){t()},null,!1,null,!1)})},t.prototype._flattenCoreStyles=function(n){for(var y,f,s,i,e,h,c,r=this._coreStyles={},u=t._sharedStyle.paletteDefinition.mapStyle,l=n.palette,p=Object.keys(l),a=function(n){var t=r[n],e,o,i,s,f;if(t)return t;if(t=JSON.parse(JSON.stringify(l[n]||{})),e=u[n].parent,e)for(o=a(e),i=0,s=Object.keys(o);i<s.length;i++)f=s[i],t[f]===undefined&&(t[f]=o[f]);return r[n]=t,t},o=0,v=p;o<v.length;o++)i=v[o],a(i);for(y=Object.keys(u),f=0,s=y;f<s.length;f++)if(i=s[f],!r[i])for(e=u[i];e;){if(h=e.parent,c=r[h],c){r[i]=c;break}e=u[h]}},t.prototype._flattenLayerOptions=function(t){for(var o,r=this._layerOptions={},u=t.styles,s=Object.keys(u),f=function(t){var i=r[t],e,o;return i?i:(i=u[t],e=i.parent,e&&(o=JSON.parse(JSON.stringify(f(e))),i=n.mergeDeep(o,i)),r[t]=i,i)},i=0,e=s;i<e.length;i++)o=e[i],f(o)},t.prototype._parseCoreStyle=function(n){var t=this;return i.then(function(){var r,i,u,f;for(t._buckets=n.buckets,r=n.iconShadowOffset||[0,2],t.iconShadowOffset={x:r[0],y:r[1]},t.iconShadowBlur=n.iconShadowStandardDeviation||2,t.xsrVersion=n.xsrVersion,t.invertedIcons={},i=0,u=n.nonInvertibleIconBuckets;i<u.length;i++)f=u[i],t.invertedIcons[f]=!0;t._flattenCoreStyles(n);t._flattenLayerOptions(n)})},t.prototype.getReferencedShapes=function(){function r(n){return n&&(typeof n=="string"?n:n.value)}for(var t={},o=Object.keys(this._coreStyles||{}),i=0,u=o;i<u.length;i++){var s=u[i],n=this._coreStyles[s],f=r(n&&n["shape-background"]),e=r(n&&n["shape-icon"]);f&&(t[f]=!0);e&&(t[e]=!0)}return Object.keys(t)},t.prototype.getBucketImageGroupId=function(n){var t;return this._buckets&&((t=this._buckets[n])===null||t===void 0?void 0:t.img)},t.prototype.getBucketEntry=function(n){var t;return this._buckets&&((t=this._buckets[n])===null||t===void 0?void 0:t.ent)},t.prototype.getBucketLayerStyle=function(n,t){var r,i=this._buckets&&((r=this._buckets[n])===null||r===void 0?void 0:r.stl),u,f;return i&&(u=this.getStringPaletteValue("layer-style-suffix",t),u&&(f="".concat(i,"-").concat(u),this._layerOptions[f]&&(i=f))),i},t.prototype.getFontFallback=function(){var n=this._coreStyles&&this._coreStyles.global;return(n===null||n===void 0?void 0:n.fontFallback)||""},t.prototype.getImageFamily=function(){var n=this._coreStyles&&this._coreStyles.global;if(n!==null&&n!==void 0)return n.imageFamily},t.prototype.getLayerOptions=function(n){return this._layerOptions&&this._layerOptions[n]},t.prototype.getLayerStyleOrder=function(){var n=this;return this._layerOptions&&Object.keys(this._layerOptions).map(function(t){var i=n._layerOptions[t];return{styleKey:t,baseLayer:i.baseLayer,topLevel:i.topLevel}})},t.prototype.getShapeImageId=function(n){return t._sharedStyle&&t._sharedStyle.shapes[n]},t.prototype._getPaletteValue=function(n,t){var f,e,o;if(!t||!n)return null;for(f=[],e=0,o=t;e<o.length;e++){var c=o[e],s=this._coreStyles[c],r=s&&s[n];if(r!==undefined){var u=typeof r=="object"&&r,i=u===null||u===void 0?void 0:u.additionalAttributes,h=i===null||i===void 0?void 0:i.propertyReference;if(h)n=h;else if((i===null||i===void 0?void 0:i.stackingComposition)==="blend")f.unshift(r.value);else{f.unshift(u?u.value:r);break}}}return f},t.prototype.paletteElementExists=function(n){return!!this._coreStyles[n]},t.prototype.getColorPaletteValue=function(n,t){var i=this._getPaletteValue(n,t),u,f,r;if(i.length>1){for(f=s.parse(i[0]),r=1;r<i.length;r++)f.blend(s.parse(i[r]));u=f.toRgba()}else i.length===1&&(u=i[0]);return u},t.prototype.getBooleanPaletteValue=function(n,t,i){i===void 0&&(i=!1);var u=this._getPaletteValue(n,t),r;return u.length===1&&(r=u[0]),typeof r=="boolean"?r:i},t.prototype.getNumericPaletteValue=function(n,t,i){i===void 0&&(i=1);var u=this._getPaletteValue(n,t),r;return u.length===1&&(r=u[0]),typeof r=="number"?r:i},t.prototype.getStringPaletteValue=function(n,t){var i=this._getPaletteValue(n,t),r;return i.length===1&&(r=i[0]),r},t}();t.Palette=r}(r||(r={})),function(t){function i(n){var t=0;return n.polygon?t=3:n.line?t=2:(n.icon||n.iconAndLabel)&&(t=1),t}function r(n,t,i,r){for(var u,f=0,e=n;f<e.length;f++)if(u=e[f],u.primitiveType===t&&u.geometryType===i&&u.layerStyle.styleKey===r)return u;return null}function u(t,i,r){return"".concat(t,"_").concat(i,"_").concat(r,"_").concat(n._nextId())}var f=function(){function t(n){this._map=n;this._allLayers={};this._layerGroupOrder=[]}return t.prototype.dispose=function(){var i=this,t;this._allLayers&&(t=Object.keys(this._allLayers),t.forEach(function(n){return i.removeLayers(n)}));n._nullifyClass(this)},t.prototype.setDrawOrder=function(t,i){var f=this._findLayerGroupOrderIndex(t),r=f>=0?this._layerGroupOrder[f]:null,o,u,e,s;if(r&&r.drawOrder!==i){for(r.drawOrder=i,this._layerGroupOrder.splice(f,1),o=this._allLayers[t],u=0,e=o;u<e.length;u++)s=e[u],this._addOrMoveGroup(s,i,!1);n._orderedInsert(this._layerGroupOrder,r,"drawOrder")}},t.prototype.setLayerStyleOrder=function(n){var t,i;for(this._layerStyleOrder=n,this._styleEntryMap={},t=0;t<n.length;t++)i=n[t],this._styleEntryMap[i.styleKey]=i,i.orderIndex=t},t.prototype.createLayers=function(t,f,e,o,s,h){var y=this._allLayers[t]||[],ut,p,w,g,l,nt,b,tt,k,et,d,rt,ot;for(this._allLayers[t]=y,ut=this._findLayerGroupOrderIndex(t),p=this._layerGroupOrder[ut],p||(p={managerId:t,drawOrder:o},n._orderedInsert(this._layerGroupOrder,p,"drawOrder")),w=0,g=Object.keys(f);w<g.length;w++)for(l=g[w],nt=f[l],b=0,tt=Object.keys(nt);b<tt.length;b++){var ft=tt[b],a=nt[ft],it=parseInt(ft),v=i(a),c=r(y,it,v,l);if(!c&&(k=u(t,l,it),v===1?c=this._createPointGroup(k,a,e):v===2?c=this._createLineGroup(k,a,e):v===3&&(c=this._createAreaGroup(k,a,e)),c)){for(c.primitiveType=it,c.layerStyle=this._styleEntryMap[l],s&&s(c,e,f),et=["all",["!=",["get","stateName"],""],["==",["get","layerStyle"],l]],d=0,rt=c.layers;d<rt.length;d++)ot=rt[d],ot.setOptions({filter:et});y.push(c);this._addOrMoveGroup(c,o,!0);v===1&&this._setPointGroupOptions(c,a);h&&h(c)}}y.length||this.removeLayers(t)},t.prototype._createPointGroup=function(n,t,i){var r=t.icon||t.iconAndLabel,u=[new v.SymbolLayer(i,"".concat(n,"_p"),{iconOptions:r.iconOptions})];return r.textOptions&&u.unshift(new v.SymbolLayer(i,"".concat(n,"_pl"),{iconOptions:{image:""},textOptions:r.textOptions})),{groupId:n,geometryType:1,layers:u}},t.prototype._createLineGroup=function(t,i,r){for(var o,s,h=i.line,f=[],u=0,e=h;u<e.length;u++)o=e[u],s=new v.LineLayer(r,"".concat(t,"_").concat(n._nextId(),"_l"),o),f.push(s);return{groupId:t,geometryType:2,layers:f}},t.prototype._createAreaGroup=function(t,i,r){var f=[],h=i.polygon,c=i.line||[],l=new v.PolygonLayer(r,"".concat(t,"_f"),h),u,e,o,s;for(f.push(l),u=0,e=c;u<e.length;u++)o=e[u],s=new v.LineLayer(r,"".concat(t,"_").concat(n._nextId(),"_l"),o),f.push(s);return{groupId:t,geometryType:3,layers:f}},t.prototype._findLayerGroupOrderIndex=function(n){return this._layerGroupOrder.findIndex(function(t){return t.managerId===n})},t.prototype._setPointGroupOptions=function(n,t){function r(n,t,i,r,f){var e=t[i];e!==undefined&&(f?u.setLayoutProperty(n,r,e):u.setPaintProperty(n,r,e))}for(var o,i,u=this._map._getMap(),s=t.icon||t.iconAndLabel,h=s.iconOptions||{},f=s.textOptions||{},e=0,c=n.layers;e<c.length;e++)(o=c[e],o instanceof v.SymbolLayer)&&(i=o.getId(),i.endsWith("_pl")?(u.setLayoutProperty(i,"symbol-sort-key",["-",["get","symbolDrawOrder"]]),r(i,f,"variableAnchor","text-variable-anchor",!0),r(i,f,"variableAnchorOffset","text-variable-anchor-offset",!0),r(i,f,"radialOffset","text-radial-offset",!0),r(i,f,"justify","text-justify",!0),r(i,f,"padding","text-padding",!0)):(h.allowOverlap&&u.setLayoutProperty(i,"symbol-sort-key",["get","symbolDrawOrder"]),r(i,h,"padding","icon-padding",!0)),u.setLayoutProperty(i,"symbol-z-order","source"))},t.prototype._getInsertionPoint=function(n,t){var h,p=this._layerStyleOrder||[],w,r=n.layerStyle,b=r===null||r===void 0?void 0:r.styleKey,u=(h=this._styleEntryMap[b])===null||h===void 0?void 0:h.orderIndex,i,f,e,l,a,g,o,v,s,y;if(typeof u!="number")return null;for(;u<p.length;u++){if(i=p[u],f=i.styleKey,i.baseLayer){var c=this._map._getMap().getStyle().metadata,k=c===null||c===void 0?void 0:c.layerIndex,d=k&&k[f];if(typeof d=="string"){w=d;break}else continue}for(e=0,l=this._layerGroupOrder;e<l.length;e++)for(a=l[e],g=this._allLayers[a.managerId]||[],o=0,v=g;o<v.length;o++)if(s=v[o],y=s.layerStyle,n!==s&&(y.styleKey===f||y.topLevel&&i.topLevel)){if((b===f||r.topLevel&&i.topLevel)&&t>=a.drawOrder)continue;return s.layers[0].getId()}}return w},t.prototype._addOrMoveGroup=function(n,t,i){var r=this._getInsertionPoint(n,t),e,f,u,o,c;(r===null||r===void 0?void 0:r.startsWith("microsoft."))&&(e=r.split("."),r=e.length===5?e[3]:r);var s=n.layers,h=this._map,l=h.layers;for(f=s.length-1;f>=0;f--)u=s[f],o=u.getId(),i?l.add(u,r):h.layers.move(o,r),c=u.metadata=u.metadata||{},c.beforeId=r,r=o},t.prototype.removeLayers=function(n){var f=this._allLayers&&this._allLayers[n],t=[],i,r,e,u;if(f){for(i=0,r=f;i<r.length;i++)e=r[i],t.push.apply(t,e.layers);t.length>0&&(this._map.layers.remove(t),delete this._allLayers[n]);u=this._findLayerGroupOrderIndex(n);u>=0&&this._layerGroupOrder.splice(u,1)}},t.prototype.setLayerOptions=function(n,t,i){for(var s,r,f,h,e=this._findGroups(n,i),u=0,o=e;u<o.length;u++)for(s=o[u],r=0,f=s.layers;r<f.length;r++)h=f[r],h.setOptions(t);return e.length>0},t.prototype._findGroups=function(n,t){var r=this._allLayers&&this._allLayers[n],u=[],i,f,e;if(r)if(t)for(i=0,f=r;i<f.length;i++)e=f[i],e.geometryType===t&&u.push(e);else u=r;return u},t}();t.PrimitiveLayerManager=f}(r||(r={})),function(t){function r(n){return Math.round(n*e)/e}function f(n,t){n&&(n.properties=o(o({},n.properties||{}),t||{}))}var e=Math.pow(10,6),s=function(e){function s(n){var i=e.call(this)||this,r;return i._map=n,i._primitives={},i._layerOptions={},i._iconsNeeded={},i._drawOrder=0,i._shapeCount=0,i._images=t.getImages(n),i._layerManager=t.getLayerManager(n),i._templateSelector=t.getTemplateSelector(n),i.useSymbolDrawOrder=!0,r=i._hitTestManager=t.getHitTestManager(n),r.registerPrimitiveManager(i),i._disposables=[i.primitiveDragStart=new h,i.primitiveDragging=new h,i.primitiveDragEnd=new h,i.primitiveDragCancel=new h,i.primitiveClicked=new h,i.primitiveRightClicked=new h,i.primitiveHoverStart=new h,i.primitiveHovering=new h,i.primitiveHoverStop=new h,b.add(n,"stylechanged",function(){i._onMapStyleChanged()})],i._q=new at,i}return g(s,e),s.prototype.dispose=function(){var t;if(!this._isDisposed){if(this._source){this._layerManager.removeLayers(this.id);try{this._map.sources.remove(this._source)}catch(i){}}(t=this._geoJsonSource)===null||t===void 0?void 0:t.dispose();this._images.removeAllReferences(this.id);this._hitTestManager.unregisterPrimitiveManager(this);n._clearDisposables(this._disposables);n._nullifyClass(this);this._isDisposed=!0}},s.prototype.add=function(n){var t=this,i=function(n){var i=Promise.resolve();return!n||!n.length||t._isDisposed?i:Promise.all([t._createSource(),t._templateSelector.selectorReady()]).then(function(){var u,r,f,o,e;if(t._isDisposed||!t._source)return i;for(u=[],r=0,f=n;r<f.length;r++)o=f[r],e=t._addOrUpdate(o),e&&u.push(e);return Promise.all(u).then(function(n){t._isDisposed||(t._currentSpriteUrl=t._map._getMap().getStyle().sprite,t._layerManager.createLayers(t.id,t._layerOptions,t._source,t._drawOrder,function(n,i){t._modifyLayerGroup(n,i,t._layerOptions)},function(n){t._setLayerOptions(n)}),n=n.filter(function(n){return!!n}),t._calculateSourceIndex(n),t._geoJsonSource.addOrUpdate(n))})})};return this._q.enqueue(function(){return i(n)})},s.prototype._calculateDrawOrder=function(n,t){if(this.useSymbolDrawOrder&&this._shapeCount){var i=(t.drawOrder||0)*this._shapeCount-(t.sourceIndex||0);if(t.symbolDrawOrder!==i)return t.symbolDrawOrder=i,f(n,t),!0}return!1},s.prototype._calculateSourceIndex=function(n){var u,r,t,o,i,f,e;if(this.useSymbolDrawOrder)for(r=(u=this._geoJsonSource)===null||u===void 0?void 0:u.getFeatureCollection(),t=(r===null||r===void 0?void 0:r.features)||[],n&&t.push.apply(t,n),o=this._shapeCount=t.length,i=0;i<o;i++)f=t[i],e=f.properties,e.sourceIndex=i,this._calculateDrawOrder(f,e)},s.prototype.clear=function(){var n=this,t=function(){var t;return n._isDisposed||(n._primitives={},(t=n._geoJsonSource)===null||t===void 0?void 0:t.clear()),Promise.resolve()};return this._q.enqueue(t)},s.prototype.getPrimitives=function(){return this._primitives},s.getPrimitiveId=function(n){var t=n instanceof atlas.Shape?n.getProperties():n.properties;if(t!==null&&t!==void 0)return t.primitiveId},s.prototype.getManagedPrimitive=function(n){var t=n&&this._primitives[n];return t?t.primitive:null},s.prototype._resetHoveredPrimitive=function(n){var i=this._primitives[this._hoverPrimitiveId],t=i===null||i===void 0?void 0:i.primitive;t&&(this._hoverPrimitiveId=null,(t.state===3||t.state===7)&&(t.state=this._oldPrimitiveState,t.drawOrder=this._oldPrimitiveDrawOrder,this.update([t])),this.primitiveHoverStop.invoke({primitive:t,event:n}))},s.prototype.hoverPrimitive=function(n,t,r){var f,e,u;this._isDisposed||(f={primitive:n,event:t},r?(this._hoverPrimitiveId=n.id,this._oldPrimitiveState=n.state,this._oldPrimitiveDrawOrder=n.drawOrder,e=n.state===2,u=n.state===5,(e||u)&&(n.state=u&&i.stackRetiredHovered?7:3,n.drawOrder=4,this.update([n])),this.primitiveHoverStart.invoke(f)):this._hoverPrimitiveId===n.id&&this._resetHoveredPrimitive(t))},s.prototype.clickPrimitive=function(n,t,i){var r={primitive:n,event:t};this._resetHoveredPrimitive(t);i?this.primitiveRightClicked.invoke(r):this.primitiveClicked.invoke(r)},s.prototype.dragPrimitive=function(n,t,i){var u={primitive:n,event:t},r;switch(i){case 0:r=this.primitiveDragStart;break;case 1:r=this.primitiveDragging;break;case 2:r=this.primitiveDragEnd;break;case 3:r=this.primitiveDragCancel}r===null||r===void 0?void 0:r.invoke(u)},s.prototype.remove=function(n){var t=this,i=function(n){var u,r,f,i,e;if(!t._isDisposed){for(r=0,f=n;r<f.length;r++)i=f[r],i&&(e=t._primitives[i.id],e&&(delete t._primitives[i.id],t._hoverPrimitiveId===i.id&&(t._hoverPrimitiveId=null),(u=t._geoJsonSource)===null||u===void 0?void 0:u.removeByIds([i.id])));t._calculateSourceIndex()}return Promise.resolve()};return this._q.enqueue(function(){return i(n)})},s.prototype.setDrawOrder=function(n){this._drawOrder=n;this._layerManager&&this._layerManager.setDrawOrder(this.id,n)},s.prototype.setLayerOptions=function(n,t){return this._layerManager&&this._layerManager.setLayerOptions(this.id,n,t)},s.prototype.update=function(n){var t=this,i=function(n){var u,i,f,r,e,o;if(!n||!n.length||t._isDisposed)return Promise.resolve();for(u=[],i=0,f=n;i<f.length;i++)r=f[i],e=r&&t._primitives[r.id],e&&(o=t._update(r,e.shape),o&&u.push(o));return Promise.all(u).then(function(n){t._isDisposed||(t._layerManager.createLayers(t.id,t._layerOptions,t._source,t._drawOrder,function(n,i){t._modifyLayerGroup(n,i,t._layerOptions)},function(n){t._setLayerOptions(n)}),t._geoJsonSource.addOrUpdate(n))})};return this._q.enqueue(function(){return i(n)})},s.prototype.getPrimitiveIcon=function(n){var t=this._getFeatureProperties(n,null);return this._prepareIconPromise(n,t)},s.prototype._addOrUpdate=function(t){if(!t)return null;t.id||(t.id=n._nextId().toString());var i=this._primitives[t.id];return i?this._update(t,i.shape).then(function(){return null}):this._add(t)},s.prototype._add=function(n){var t=this._createShape(n);return t?(this._primitives[n.id]={primitive:n,shape:t},this._update(n,t)):null},s.prototype._update=function(n,t){var u=this,i,r;return!n||!t?null:(i=this._getFeatureProperties(n,t),i&&(this._addLayerTypes(n,i),n.geometry.geometryType===1?r=this._addIcon(n,i).then(function(){return u._calculateDrawOrder(t,i)||f(t,i),s.updateShapeGeometry(n,t),t}):(this._calculateDrawOrder(t,i)||f(t,i),s.updateShapeGeometry(n,t),r=Promise.resolve(t)),this._primitives[n.id].primitive=n),r)},s.prototype._prepareIconPromise=function(n,t){var s=this,o;if(!t.stateName)return Promise.resolve(null);var u=t.iconText,h=!p.simpleIcon&&!!u,f=!p.simpleIcon&&i.renderTextInVectorImages,e=this._templateSelector,r="".concat(e.getTemplateName(),";").concat(t.stateName,";").concat(t.primitiveType,";").concat(t.bucket,";").concat(t.stylesheetEntry,";").concat(t.stylesheetEntryState,";").concat(n.badge,",").concat(f?u:h);return t.iconImage=r,this._iconsNeeded[r]||this._images.hasImage(r)?o=this._images.addReference(this.id,r):(this._iconsNeeded[r]=!0,o=e.getPoiTemplate(n.bucket,n.state,this._map.getCamera().zoom,t.primitiveType,h,n.stylesheetEntry,n.stylesheetEntryState).then(function(t){var r=t.renderIconWithMetadata(f&&u||null,f,i.iconOversample);return n.badge?k.addBadge(e,r,n.badge):r}).then(function(n){return s._images.addImage(s.id,r,n)})),o},s.prototype._addIcon=function(n,t){return this._prepareIconPromise(n,t).then(function(n){n&&(t.iconAnchor=n.anchor,t.iconOffset=n.offset)})},s.prototype._createSource=function(){var n=this,t=this._sourcePromise,i;return t||(i=this.id+"_ds",t=this._sourcePromise=this._map.createDataSource(i).then(function(t){return n._isDisposed&&(t=null),n._source=t,n._geoJsonSource||(n._geoJsonSource=new ct.GeoJSONSourceManager(n._map._getMap(),i)),t})),t},s.prototype._createShape=function(n){var t=n.geometry,f,i,c,s,l,h,a,e,v,o;if(t.geometryType===1)i=new u.Position(r(t.x),r(t.y)),f=new u.Point(i);else if(t.geometryType===3){for(c=[],s=0,l=t.rings;s<l.length;s++){for(h=l[s],a=[],e=0;e<h.x.length;e++)i=new u.Position(r(h.x[e]),r(h.y[e])),a.push(i);c.push(a)}f=new u.Polygon(c,t.bbox)}else if(t.geometryType===2){for(v=[],o=0;o<t.x.length;o++)i=new u.Position(r(t.x[o]),r(t.y[o])),v.push(i);f=new u.LineString(v)}return f&&new u.Feature(f,{primitiveId:n.id},n.id)},s.prototype._getFeatureProperties=function(n,t){var u=n.geometry.geometryType,f=n.primitiveType,s=n.iconText||"",r=p.simpleIcon,i={primitiveId:n.id,title:r?"":n.title||"",subtitle:r?"":n.subtitle||"",bucket:n.bucket,stylesheetEntry:n.stylesheetEntry||"",stylesheetEntryState:n.stylesheetEntryState||"",primitiveType:f,stateName:this._templateSelector.getPrimitiveTypeStateNames(u,n.state,f).join(","),noPrint:n.noPrint},e;return u===1&&(i.iconText=r?"":s,i.drawOrder=n.drawOrder),this._templateSelector.setFeatureStyleProps(n,i),e=(t===null||t===void 0?void 0:t.properties)||{},o(o({},e),i)},s.prototype._addLayerTypes=function(n,t){var u=this._layerOptions,f=n.geometry.geometryType,i=t.layerStyle,r;if(i){if(u[i]||(u[i]={}),r=1,f===1)switch(n.primitiveType){case 12:r=12;break;case 11:r=11}u[i][r]||(u[i][r]=this._templateSelector.getLayerOptions(i))}},s.prototype._modifyLayerGroup=function(n,t,i){this.modifyLayerGroupCallback&&this.modifyLayerGroupCallback(n,t,i)},s.prototype._setLayerOptions=function(n){this.setLayerOptionsCallback&&this.setLayerOptionsCallback(n)},s.prototype._onMapStyleChanged=function(){var n=this,t=this._map._getMap().getStyle().sprite,i=Object.keys(this._primitives).length;(this._currentSpriteUrl!==t||i)&&this._templateSelector.selectorReady().then(function(){var t=Object.keys(n._primitives).map(function(t){return n._primitives[t].primitive});n._layerOptions={};n._layerManager.removeLayers(n.id);n.update(t)});this._currentSpriteUrl=t},s.updateShapeGeometry=function(n,t){var i=n.geometry,r,f;switch(i.geometryType){case 1:t.geometry.coordinates=new u.Position(i.x,i.y);break;case 2:r=s._getLineCoordinates(i.x,i.y);r&&(t.geometry.coordinates=r);break;case 3:f=s._getAreaCoordinates(i.rings);f&&(t.geometry.coordinates=f)}},s._getLineCoordinates=function(n,t){var r,i;if(n&&t&&n.length&&n.length===t.length){for(r=[],i=0;i<n.length;i++)r.push(new u.Position(n[i],t[i]));return r}return null},s._getAreaCoordinates=function(n){var i,t,r,u,f;if(n&&n.length){for(i=[],t=0,r=n;t<r.length;t++)if(u=r[t],f=s._getLineCoordinates(u.x,u.y),f)i.push(f);else return null;return i}return null},s.isTextLayer=function(n){return n.endsWith("_pl")},s.isIconLayer=function(n){return n.endsWith("_p")},s}(rt);t.PrimitiveManager=s}(r||(r={})),function(n){var t;(function(n){function i(n,t,i,r){var e=n===null||n===void 0?void 0:n._getMap(),o={padding:i},s,f;return r&&(o.maxZoom=r),s=[u.BoundingBox.getWest(t),u.BoundingBox.getSouth(t),u.BoundingBox.getEast(t),u.BoundingBox.getNorth(t)],f=e===null||e===void 0?void 0:e.cameraForBounds(s,o),f&&{center:[f.center.lng,f.center.lat],zoom:f.zoom}}function r(n,t,r,f){var e,o;return t&&t.length>0&&(t=pt.cullOutlierPositions(t),o=u.BoundingBox.fromPositions(t),e=i(n,o,r,f),e.zoom-=lt.zoomAdjustment),e}function t(n){var r=[],f,c,i,e,l,o,v,s,a,h,t;if(n)for(f=0,c=n;f<c.length;f++)if(i=c[f],e=i.geometry.geometryType,1===e)l=i.geometry,r.push(new u.Position(l.x,l.y));else if(2===e)for(o=i.geometry,t=0;t<o.x.length;t++)r.push(new u.Position(o.x[t],o.y[t]));else if(3===e)for(v=i.geometry,s=0,a=v.rings;s<a.length;s++)for(h=a[s],t=0;t<h.x.length;t++)r.push(new u.Position(h.x[t],h.y[t]));return r}function f(n,i,u,f){var e=t(i);return r(n,e,u,f)}function e(n,i){var r=!1,f=t([i]),u=n.getCamera().bounds;return u&&(r=f.every(function(n){return atlas.data.BoundingBox.containsPosition(u,n)})),r}n.cameraFromBounds=i;n.viewFromPositions=r;n.positionsFromPrimitives=t;n.viewFromPrimitives=f;n.isPrimitiveInView=e})(t=n.ViewHelper||(n.ViewHelper={}))}(r||(r={})),function(n){function t(n,t){return n&&t?n.id===t.id:!n&&!t}n.arePrimitivesEqual=t}(r||(r={})),function(n){function r(n,r){var a=n;if(n&&r){var b=i.iconOversample,o=r.renderIcon(null,b),u=n.icon,v=u.width,s=u.height,y=n.offset,l=n.metadata.pixelRatio,f=n.iconPadding,p=o.width/2-t.x*l,w=Math.ceil(v-f.right+Math.max(f.right,o.width-p)),e=Math.ceil(s-f.top+Math.max(f.top,o.height/2-t.y*l)),h=document.createElement("canvas"),c=h.getContext("2d",{willReadFrequently:!0});h.width=w;h.height=e;u instanceof HTMLImageElement?c.drawImage(u,0,e-s):c.putImageData(u,0,e-s);c.drawImage(o,v-f.right-p,0);a={icon:c.getImageData(0,0,w,e),metadata:n.metadata,anchor:n.anchor,offset:[y[0],y[1]-(e-s)/l],canvas:h}}return a}function f(n,t,i){var f=u[i],e=Promise.resolve(t);return f?n.getShape(f).then(function(n){return r(t,n)},function(){return e}):e}var t={x:-2,y:3},u;n.addBadgeTemplate=r;u=["","hotTag","newTag","dealsTag"];n.addBadge=f}(k||(k={}));w=function(){function t(n,t){this._rasterDPIScale=t;this._canvas=n||document.createElement("canvas");this._context=this._canvas.getContext("2d",{willReadFrequently:!0});this._style=this._resetStyle={fillStyle:this._context.fillStyle,strokeStyle:this._context.strokeStyle,lineWidth:this._context.lineWidth}}return t.getLineHeight=function(n){var u=t._lineHeights[n],i,r;return u||(i=t._scratchElement,i||(i=t._scratchElement=document.createElement("div"),document.body.appendChild(i),i.appendChild(document.createTextNode("X")),r=i.style,r.visibility="hidden",r.position="fixed",r.left="100%",r.top="100%",r.lineHeight="100%"),i.style.font=n,u=t._lineHeights[n]=i.offsetHeight),u},t.prototype.setGlobalAlpha=function(n){this._context.globalAlpha=n},t.prototype.getGlobalAlpha=function(){return this._context.globalAlpha},t.prototype.save=function(){this._context.save()},t.prototype.restore=function(n){this._context.restore();n!==!1&&(this._font=null,this._style=this._resetStyle)},t.prototype.getDataURL=function(){return this._canvas.toDataURL()},t.prototype.setSize=function(n,t,i){var r=i?1:this.getDevicePixelRatio(!0);this._canvas.width=n*r;this._canvas.height=t*r;this._canvas.style.width=n+"px";this._canvas.style.height=t+"px";this._context.scale(r,r)},t.prototype.getSize=function(){return new it(this._canvas.width,this._canvas.height)},t.prototype.clear=function(n,t,i,r,u){if(t=t||0,i=i||0,r=r||this._canvas.width,u=u||this._canvas.height,n){var f=this._context.fillStyle;this._context.fillStyle=n;this._context.fillRect(t,i,r,u);this._context.fillStyle=f}else this._context.clearRect(t,i,r,u)},t.prototype.setFont=function(n){n!==this._font&&(this._context.font=n,this._font=n)},t.prototype.translate=function(n,t){this._context.translate(n,t)},t.prototype.setStyle=function(i,r,u,f){var e=this._context,h,c;if(this._style=i,r=r||1,h=this._createGradient(u),c=this._createGradient(f),e.fillStyle=h||i.fillStyle||"transparent",e.strokeStyle=c||i.strokeStyle||"transparent",e.lineWidth=Math.round(i.lineWidth*n._getFinite(i.lineWidthScale,1)*r)||0,e.lineCap=i.lineCap||"round",e.lineJoin=i.lineJoin||"round",e.setLineDash&&(e.setLineDash(t._prepareLineDashes(i.dashes,e.lineWidth,!0)),e.lineDashOffset=Math.round((i.dashOffset||0)*e.lineWidth)),i.font){var l=i.horizontalAlignment,a=i.verticalAlignment,o="center",s="middle";l===1?o="left":l===2&&(o="right");a===0?s="bottom":a===2&&(s="hanging");e.textAlign=o;e.textBaseline=s}e.shadowColor=i.shadowColor||"transparent";e.shadowBlur=i.shadowBlur||0;i.shadowOffset&&(e.shadowOffsetX=i.shadowOffset.x||0,e.shadowOffsetY=i.shadowOffset.y||0)},t.prototype.getStyle=function(){return this._style},t.prototype.flush=function(){var t=this._context.shadowColor;this._needsFill&&(this._context.fill(),this._context.shadowColor="transparent");this._needsStroke&&this._style.lineWidth>0&&n._getFinite(this._style.lineWidthScale,1)>0&&this._context.stroke();this._needsStroke=this._needsFill=!1;this._context.shadowColor=t;this._context.beginPath()},t.prototype.stroke=function(){this._needsStroke=!0},t.prototype.fill=function(){this._needsFill=!0},t.prototype.getImageData=function(n,t,i,r){return this._context.getImageData(n,t,i,r)},t.prototype.getRawContext=function(){return this._context},t.prototype.getRootElement=function(){return this._canvas},t.prototype.getDevicePixelRatio=function(n){return(!this._devicePixelRatio||n)&&(this._devicePixelRatio=this._rasterDPIScale||window.devicePixelRatio||1),this._devicePixelRatio},t.prototype.putImageData=function(n,t,i,r,u,f,e){typeof r=="number"?this._context.putImageData(n,t,i,r,u,f,e):this._context.putImageData(n,t,i)},t.prototype.drawImage=function(n,t,i,r,u,f,e,o,s,h){var l=this._context.globalAlpha,c;f&&(this._context.globalAlpha=f);try{c=this.getDevicePixelRatio();r&&u&&typeof e=="number"&&typeof o=="number"&&s&&h?this._context.drawImage(n,e,o,s/c,h/c,t||0,i||0,r/c,u/c):r&&u?this._context.drawImage(n,t||0,i||0,r/c,u/c):this._context.drawImage(n,t||0,i||0)}catch(a){}this._context.globalAlpha=l},t.prototype.drawEllipse=function(n,t,i,r){if(i===r)this._context.arc(n,t,i,0,2*Math.PI,!1);else{var u=r/.75;this._context.beginPath();this._context.moveTo(n-i,t);this._context.bezierCurveTo(n-i,t+u,n+i,t+u,n+i,t);this._context.bezierCurveTo(n+i,t-u,n-i,t-u,n-i,t)}},t.prototype.lineTo=function(n,t){this._context.lineTo(n,t)},t.prototype.moveTo=function(n,t){this._context.moveTo(n,t)},t.prototype.dispose=function(){var n=this._canvas;n&&(n.parentNode&&n.parentNode.removeChild(n),this._canvas=null);this._context=null},t._prepareLineDashes=function(n,t,i){var r=[],u;if(n&&n.length>0)for(r=n.slice(0),u=0;u<r.length;u++)r[u]=i?Math.round(r[u]*t):r[u]*t;return r},t.prototype._createGradient=function(n){var f=this._context,t,i,r,u;if(!n||!n.stops)return null;switch(n.gradientType){case"linear":t=f.createLinearGradient(n.x0,n.y0,n.x1,n.y1);break;case"radial":t=f.createRadialGradient(n.x0,n.y0,n.r0,n.x1,n.y1,n.r1)}if(t)for(i=0,r=n.stops;i<r.length;i++)u=r[i],t.addColorStop(u.offset,u.color);return t},t._lineHeights={},t}(),function(t){var r=function(t){function r(n,u,f){var e=t.call(this)||this,s,l,o;e._image=n;typeof u!="number"&&(u=1);e._scale=u;e._anchor=f;e._cachedTextScale={};e._container=nt.renderVectorImageOnDOM?document.body:null;e._iconTextYAdjust=nt.iconTextYAdjust;var a=i.renderTextInVectorImages,h=[],c=[],v=n.records||[];for(s=0,l=v;s<l.length;s++)o=l[s],o.scale=isFinite(o.scale)?o.scale:1,o.vectorType===3?(o.text===r.placeholderText&&(e.hasPlaceholderText=!0,e._templateTextRecord=o),a?c.push(o):o.text===r.placeholderText?e._parseRecord(o):h.push(o)):h.push(o);return e._vectorRecords=h,e._textRecords=c,e.hasText=c.length>0,e.shadowStyle={},e}return g(r,t),r.prototype.getVectorImage=function(){return this._image},r.prototype.getScale=function(){return this._scale},r.prototype.getAnchor=function(){return this._anchor},r.prototype.setScale=function(n){this._scale=n===0?0:n||1},r.prototype.getBounds=function(){var n=this._getMetrics(null),i=n.anchorX,r=n.anchorY,u=n.scaleX,f=n.scaleY,t=this._bounds;return c.fromSides(u*(t.minPoint.x-i),u*(t.maxPoint.x-i),f*(t.minPoint.y-r),f*(t.maxPoint.y-r))},r.prototype._getMetrics=function(n){this._parseRecords();var t=this._bounds,u=t.getSize(),f=u.width,e=u.height,o=this.hasText&&this._getTextScale(n)||{width:1,height:1},s=o.width*this._scale,h=o.height*this._scale,i=this._anchor.x,r=this._anchor.y;return this._anchor.units===0&&(i=i*f+t.minPoint.x,r=r*e+t.minPoint.y),{anchorX:i,anchorY:r,scaleX:s,scaleY:h,width:f,height:e}},r.prototype._getTextScale=function(n){var t=this._templateTextRecord,f=this._cachedTextScale,e=1,o,i,u,c,l;if(n=n||"",o=n.length||0,i=f[n],i)return i;if(o>1&&t&&t.maxWidth>0&&t.style.horizontalAutoScaling===1){var s=r._scratchContext,h=this._bounds.getSize().width,a=h-t.maxWidth;typeof t.style.fontStyleString!="string"&&r._processFontStyle(t);u=t.style;s.setFont("".concat(u.fontStyleString," ").concat(u.fontSize,"pt ").concat(u.font));c=s.getRawContext().measureText(n).width;l=a+c;e=Math.max(1,l/h)}return i=new it(e,1),f[n]=i,i},r.prototype._getTextValues=function(n){for(var f,i=[],t=0,u=this._textRecords;t<u.length;t++)f=u[t],i.push(r._getText(f,r.placeholderText,n));return i},r._getText=function(n,t,i){var r=n.text;return r===t&&(r=i||""),r},r.prototype._parseRecords=function(){var n=this._bounds,t=this._image,u,i,r,f;if(!n){for(n=c.empty(),u=t.records||[],i=0,r=u;i<r.length;i++)f=r[i],n.union(this._parseRecord(f));this._bounds=n}this._anchor||(n.isEmpty()||(typeof t.hotspotX!="number"&&(t.hotspotX=(n.minPoint.x+n.maxPoint.x)/2),typeof t.hotspotY!="number"&&(t.hotspotY=(n.minPoint.y+n.maxPoint.y)/2)),this._anchor=new st(t.hotspotX,t.hotspotY))},r.prototype._parseRecord=function(t){var i,u,e,o,s,f;if(!t)return c.empty();switch(t.vectorType){case 2:t.bounds=c.fromPoints({x:t.centerX-t.radiusX,y:t.centerY-t.radiusY},{x:t.centerX+t.radiusX,y:t.centerY+t.radiusY});break;case 4:r._parsePathGeometry(t);break;case 0:case 1:t.bounds=c.fromPoints.apply(this,t.pointsList);break;case 3:t.leftTop&&t.rightBottom&&(t.bounds=c.fromPoints(t.leftTop,t.rightBottom))}return i=t.bounds,u=t.scale,i&&u!==1&&(e=i.minPoint,o=i.maxPoint,e.x*=u,e.y*=u,o.x*=u,o.y*=u),s=t.style,i&&t.style.lineWidth&&(f=Math.round(s.lineWidth*n._getFinite(s.lineWidthScale,1))||0,f>0&&i.buffer(f/2,f/2)),i||c.empty()},r.prototype._prepareVectorData=function(t,i,u){var l,e,f,h,c;if(i===void 0&&(i=1),l=this._image,e=[],l.records&&l.records.length>0){this._parseRecords();var a=this._getMetrics(u),o=a.scaleX*i,s=a.scaleY*i;(o!==this._cachedScaleX||s!==this._cachedScaleY||t!==this._cachedImageDPR)&&(this._cachedVectorImage=this._cacheRecords(this._vectorRecords,null,o,s),this._cachedImageDPR=t,this._cachedScaleX=o,this._cachedScaleY=s,this._cachedText=[],this._cachedTextImage=null);this.hasText&&(f=this._getTextValues(u),f.length&&!n.areArraysEqual(this._cachedText,f)&&(this._cachedTextImage=this._cacheRecords(this._textRecords,f,o,s),this._cachedText=f));h=this._cachedVectorImage.width/r._cachedImageOversample;c=this._cachedVectorImage.height/r._cachedImageOversample;e.push({source:this._cachedVectorImage,width:h,height:c,shadow:this.shadowStyle});this._cachedTextImage&&(h=this._cachedTextImage.width/r._cachedImageOversample,c=this._cachedTextImage.height/r._cachedImageOversample,e.push({source:this._cachedTextImage,width:h,height:c}))}return e},r.prototype._renderCanvas=function(n,t,i,r,u){var o=this._prepareVectorData(n.getDevicePixelRatio(),i,r),f,s,e;o&&o.length>0&&(f=o[0],s=void 0,f.shadow&&f.shadow.shadowColor&&(s=n.getStyle(),n.setStyle(f.shadow)),n.drawImage(f.source,u.left,u.top,f.width,f.height),s&&n.setStyle(s),e=o[1],e&&t&&n.drawImage(e.source,u.left,u.top,e.width,e.height))},r.prototype.renderIcon=function(n,t){t===void 0&&(t=1);var i=this._renderIconInternal(n,!0,t,this._getShadowPadding());return i.getRootElement()},r.prototype._renderIconInternal=function(n,t,i,r){var f=new w,u=this._getMetrics(n);return f.setSize(Math.ceil(i*u.scaleX*u.width)+r.left+r.right,Math.ceil(i*u.scaleY*u.height)+r.top+r.bottom),this._renderCanvas(f,t,i,n,r),f},r.prototype._getShadowPadding=function(){var u,f,i=this.shadowStyle,r=[0,0,0,0],e=r[0],o=r[1],s=r[2],h=r[3],n,t;return i&&i.shadowColor&&(n=(u=i.shadowOffset)!==null&&u!==void 0?u:{x:0,y:0},t=(f=i.shadowBlur)!==null&&f!==void 0?f:0,e=Math.max(t-n.y,0),s=Math.max(t+n.y,0),h=Math.max(t-n.x,0),o=Math.max(t+n.x,0)),{top:e,right:o,bottom:s,left:h}},r.prototype.renderIconWithMetadata=function(n,t,r){var c;t===void 0&&(t=!0);r===void 0&&(r=1);var e=this._getShadowPadding(),o=this._renderIconInternal(n,t,r,e),w=o.getRawContext(),l=o.getSize(),b=w.getImageData(0,0,l.width,l.height),f=o.getDevicePixelRatio()*r,u=this._getMetrics(n),s=this._bounds.minPoint,a={pixelRatio:f};if((!i.renderTextInVectorImages||n&&!t)&&this.hasPlaceholderText){var v=this._templateTextRecord.bounds,y=v.minPoint,p=v.maxPoint,h=[f*u.scaleX*(y.x-s.x),f*u.scaleY*(y.y-s.y),f*u.scaleX*(p.x-s.x),f*u.scaleY*(p.y-s.y)],k=h[0],d=h[1],g=h[2],nt=h[3];a.content=[k,d,g,nt]}return c=this._bounds.minPoint,{icon:b,canvas:o.getRootElement(),metadata:a,anchor:"top-left",offset:[u.scaleX*(c.x-u.anchorX)-e.left/f,u.scaleY*(c.y-u.anchorY)-e.top/f],iconPadding:e}},r.prototype._cacheRecords=function(n,t,i,u){var p=this._bounds.getSize(),l=r._cachedImageOversample,a=i*l,v=u*l,h=r._cachedImageBuffer*l,k=Math.ceil(a*p.width)+h,d=Math.ceil(v*p.height)+h,c=new w,y=c.getRootElement(),f,e,o,s,b;for(c.setSize(k,d),this._container&&(f=y.style,f.display="none",f.outline="none",f.position="absolute",f.left="-1000px",f.top="-1000px",this._container.appendChild(y)),e=-a*this._bounds.minPoint.x,o=-v*this._bounds.minPoint.y,e=(isNaN(e)?0:e)+h/2,o=(isNaN(o)?0:o)+h/2,s=0,b=n.length;s<b;s++)this._renderRecord(c,t&&t[s],n[s],e,o,a,v);return this._container&&this._container.removeChild(y),c.getRootElement()},r.prototype._renderRecord=function(n,t,i,r,u,f,e){var o,s,h;if(i){o=i.style;o&&(s=this._scaleGradientDefinition(i,o.fillGradient,r,u,f,e),h=this._scaleGradientDefinition(i,o.strokeGradient,r,u,f,e),n.setStyle(i.style,e,s,h));switch(i.vectorType){case 0:case 1:this._renderPolyRecord(n,i,r,u,f,e);break;case 2:this._renderEllipseRecord(n,i,r,u,f,e);break;case 4:this._renderPathRecord(n,i,r,u,f,e);break;case 3:this._renderTextRecord(n,i,t,r,u,f,e)}n.flush()}},r.prototype._scaleGradientDefinition=function(n,t,i,r,u,f){if(!t||!n.bounds)return null;var l=n.bounds.getSize(),e=l.width,o=l.height,a=n.bounds.minPoint,s=a.x,h=a.y,c=n.scale||1;return n.vectorType===4&&(e/=c,o/=c,s/=c,h/=c,i=r=0,u=f=1),t.gradientType==="linear"?{gradientType:"linear",x0:i+u*(s+t.x0*e),y0:r+f*(h+t.y0*o),x1:i+u*(s+t.x1*e),y1:r+f*(h+t.y1*o),stops:t.stops}:{gradientType:"radial",x0:i+u*(s+t.x0*e),y0:r+f*(h+t.y0*o),r0:u*t.r0*e,x1:i+u*(s+t.x1*e),y1:r+f*(h+t.y1*o),r1:u*t.r1*e,stops:t.stops}},r._getFontWeight=function(n){var t="";return(n&16)!=0?t="600":(n&1)!=0?t="bold":(n&32)!=0&&(t="300"),t},r._getFontStyle=function(n){var t="";return(n&2)!=0&&(t="italic"),t},r._processFontStyle=function(n){var i=n.style.fontStyle,t=r._getFontWeight(i)+" "+r._getFontStyle(i);t=t.trim();t&&(t+=" ");n.style.fontStyleString=t},r.prototype._renderTextRecord=function(n,t,i,u,f,e,o){var p=n.getRawContext(),h=t.anchor||{x:0,y:0},c,l,y;e*=t.scale;o*=t.scale;c=u+h.x*e;l=f+h.y*o;typeof t.style.fontStyleString!="string"&&r._processFontStyle(t);var s=t.style,a="".concat(s.fontStyleString," ").concat(s.fontSize*o,"pt ").concat(s.font),v=0;this._iconTextYAdjust&&(y=w.getLineHeight(a),v=y*this._iconTextYAdjust);n.setFont(a);p.fillText(i,c,l+v)},r.prototype._renderPathRecord=function(n,t,i,r,u,f){if(t.path){var e=n.getRawContext(),o=t.path,s=u*t.scale,h=f*t.scale,c=i!==0||r!==0||s!==1||h!==1;c&&(e.save(),e.translate(i,r),e.scale(s,h));t.style.fillStyle&&e.fill(o);t.style.strokeStyle&&e.stroke(o);c&&e.restore()}},r.prototype._renderPolyRecord=function(n,t,i,r,u,f){var e=n.getRawContext();this._renderLines(e,t.pointsList,i,r,u*t.scale,f*t.scale);t.vectorType===0&&e.closePath();t.style.fillStyle&&n.fill();t.style.strokeStyle&&n.stroke()},r.prototype._renderEllipseRecord=function(n,t,i,r,u,f){u*=t.scale;f*=t.scale;n.drawEllipse(t.centerX*u+i,t.centerY*f+r,t.radiusX*u,t.radiusY*f);t.style.fillStyle&&n.fill();t.style.strokeStyle&&n.stroke()},r.prototype._renderLines=function(n,t,i,r,u,f){var o,e,s,h;if(n&&t&&t.length)for(o=t[0],n.moveTo(o.x*u+i,o.y*f+r),e=0,s=t;e<s.length;e++)h=s[e],n.lineTo(h.x*u+i,h.y*f+r);else throw new Error("raw context is null or points array is invalid");},r._parsePathGeometry=function(n){function l(n,t){it=lt(it,n);ft=lt(ft,t);ot=at(ot,n);st=at(st,t)}var rt=n&&n.pathData,s,u,f;if(!rt)throw new Error("Invalid path geometry string");for(var et=!1,p=0,k=0,a=0,d=0,h=0,ct=0,ut="",t=[],w=!1,e=0,o=0,g=0,nt=0,v=0,y=0,lt=Math.min,at=Math.max,it=Number.MAX_VALUE,ft=it,ot=-it,st=-ft;!et;){var i=p<rt.length?rt.charAt(p):null,ht=!1,b=void 0;switch(k){case 0:if(i)if(i>="0"&&i<="9"||i==="."||i==="-"){if(d===0||d===2)throw new Error("Encountered value with no valid command");a=d;h=ct}else if(i>="a"&&i<="z"||i>="A"&&i<="Z"){if(ct=h,i>="a"&&i<="z"?(h=2,i=i.toUpperCase()):h=1,d=a,a=r._pathCommands[i],!a){a=d;throw new Error("Unknown command");}a!==2&&(k=1,t=[]);p++}else p++;else et=!0;break;case 1:i?i>="a"&&i<="z"||i>="A"&&i<="Z"?(k=0,ht=!0):i>="0"&&i<="9"||i==="."||i==="-"?(ut="",k=2):p++:(et=!0,ht=!0);break;case 2:i&&(i>="0"&&i<="9"||i==="."||i==="-"&&ut.length===0)?(ut+=i,p++):(t.push(parseFloat(ut)),k=1);break;default:throw new Error("Invalid state in parsing path geometry");}if(ht){s=t.length;switch(a){case 1:case 3:if(s===0||(s&1)!=0)throw new Error("Invalid number of parameters for ".concat(a===1?"MoveTo":"LineTo"," command"));for(b=s/2,u=0;u<b;u++){switch(h){case 1:e=t[u*2];o=t[u*2+1];break;case 2:e+=t[u*2];o+=t[u*2+1];break;default:throw new Error("Unknown command type");}l(e,o);w=!1}break;case 4:if(s===0)throw new Error("Invalid number of parameters for HorizontalLineTo command");for(u=0;u<s;u++){switch(h){case 1:e=t[u];break;case 2:e+=t[u];break;default:throw new Error("Unknown command type");}l(e,o);w=!1}break;case 5:if(s===0)throw new Error("Invalid number of parameters for VerticalLineTo command");for(u=0;u<s;u++){switch(h){case 1:o=t[u];break;case 2:o+=t[u];break;default:throw new Error("Unknown command type");}l(e,o);w=!1}break;case 6:if(s===0||s%6!=0)throw new Error("Invalid number of parameters for CurveTo command");for(b=s/6,u=0;u<b;u++){f=u*6;switch(h){case 1:g=t[f];nt=t[f+1];v=t[f+2];y=t[f+3];e=t[f+4];o=t[f+5];break;case 2:g=e+t[f];nt=o+t[f+1];v=e+t[f+2];y=o+t[f+3];e+=t[f+4];o+=t[f+5];break;default:throw new Error("Unknown command type");}l(g,nt);l(v,y);l(e,o);w=!0}break;case 7:if(s===0||s%4!=0)throw new Error("Invalid number of parameters for SmartCurveTo command");for(w||(v=e,y=o),b=s/4,u=0;u<b;u++){g=e*2-v;nt=o*2-y;f=u*4;switch(h){case 1:v=t[f];y=t[f+1];e=t[f+2];o=t[f+3];break;case 2:v=e+t[f];y=o+t[f+1];e+=t[f+2];o+=t[f+3];break;default:throw new Error("Unknown command type");}l(g,nt);l(v,y);l(e,o);w=!0}break;case 2:throw new Error("Internal error in handling of Close command");default:throw new Error("Invalid command");}}}n.path=new Path2D(rt);n.bounds=new c(new tt(it,ft),new tt(ot,st))},r.placeholderText="{MapDisplay}",r._cachedImageBuffer=0,r._cachedImageOversample=1,r._scratchContext=new w,r._pathCommands={M:1,Z:2,L:3,H:4,V:5,C:6,S:7,Q:8,T:9,A:10},r.defaultFont="Segoe UI",r}(rt);t.VectorImageTemplate=r}(l||(l={}));e.BingMapStyle=r;e.Color=s;f.VectorDrawing=l}catch(ft){if(e&&e.logger)e.logger.logCriticalError(ft);else throw ft;}}).call(window)