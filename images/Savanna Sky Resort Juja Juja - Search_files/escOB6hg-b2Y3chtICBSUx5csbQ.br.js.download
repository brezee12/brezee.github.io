(function(){var n;try{var r=Microsoft.Maps,o=r.Internal,ct=o.__assign,c=o.__extends,ut=o.__spreadArray,u=r.globalConfig,y=o.coreConfig,t=u.features,lt=t.advertising,at=t.autosuggest,vt=t.calendar,yt=t.collections,pt=t.directions,wt=t.feedback,l=t.flyover,h=t.landmarks3D,d=t.map3D,a=t.richMapsInfobox,bt=t.labels,kt=t.layerManager,dt=t.localGuide,g=t.localSearch,p=t.mapBuilder,gt=t.mapDelay,ni=t.optIn,ti=t.print,ii=t.sharing,ri=t.streetside,ui=t.taskBar,fi=t.taskFramework,ei=t.trafficControl,oi=t.traffic,si=t.trafficExperiences,hi=t.mapBuilderExperiences,ci=t.transit,li=t.travel,it=t.xsr,w=atlas.data,nt=atlas.layer,ot=atlas.math,ai=atlas.Pixel,vi=r.BingMapStyle,yi=r.Color,pi=r.Point,wi=r.ResourceManager,bi=r.Size,f=o.AtlasHelper,e=o.AzureMapEvents,i=o.JSEvent,st=o.LruCache,ft=o.MapsInfobox,v=o.Network,ki=o.ObjectWithId,b=o.TimeoutWrapper,f=o.AtlasHelper,e=o.AzureMapEvents,i=o.JSEvent,k=o.MapDelegate,rt=o.dependencyResolver,s=r.ResourceManager.MapCore,ht=o._Url,tt=o.MapMath;(function(n){var f="id_h",r="web3dview",e=".mapBannerContainer",u,i,t;n.fullScreen=function(n){if(n!==i){var o=document.getElementById("mapContainer"),s=document.getElementById("taskArea"),h=document.getElementById(f),c=document.querySelector(e);n?(i=!0,c&&t===undefined&&(t=c.style.display,c.style.display="none"),o&&(u=o.style.width,o.style.width="100%"),s&&(s.style.display="none"),h&&(h.style.display="none"),document.body.classList.add(r)):(i=!1,t!==undefined&&(c.style.display=t,t=undefined),s&&(s.style.display="block"),o&&(o.style.width=u),h&&(h.style.display="block"),document.body.classList.remove(r))}}})(n||(n={})),function(n){var t=function(t){function i(i){var r=this,u=i.clientProperties;return(u===null||u===void 0?void 0:u.baseMapFeatureDelegate)?u.baseMapFeatureDelegate:(r=t.call(this,i)||this,u&&(u.baseMapFeatureDelegate=r),r._isActive=!0,r._canvasContainer=i.getCanvasContainer(),r._disposables=[r._rasterHoverDelegate=new n.RasterHoverDelegate(i),e.add(i,"click",function(n){r._handleMouseClick(r._updateShapeData(n),!1)}),e.add(i,"contextmenu",function(n){r._handleMouseClick(r._updateShapeData(n),!0)}),e.add(i,"mousedown",function(n){r._handleMouseDown(r._updateShapeData(n))}),e.add(i,"mouseup",function(n){r._handleMouseUp(r._updateShapeData(n))}),e.add(i,"mousemove",function(n){r._handleMouseMove(r._updateShapeData(n))}),e.add(i,"mouseout",function(n){r._handleMouseOut(r._updateShapeData(n))}),e.add(i,"movestart",function(){r._mapMoving=!0}),e.add(i,"moveend",function(){r._mapMoving=!1})],r._initialize(),r)}return c(i,t),i.prototype.dispose=function(){this._isDisposed||(t.prototype.dispose.call(this),f._nullifyClass(this))},i.prototype.setActiveState=function(n){if(this._isActive=n,!n){var t=this._handler,i=this._featureInfo,r={preventDefault:function(){},map:this._map,type:"mouseout"};this._canDrag&&(this._isDragging&&(this._isDragging=!1,t===null||t===void 0?void 0:t.dragFeature(i,r,3)),this._canDrag=!1);t&&(t.leaveFeature(i,r),this._handler=undefined,this._featureInfo=undefined)}},i.prototype.getEventEmitter=function(n){return this.mapFeatureEventEmitters[n]},i.prototype.registerGlobalHandler=function(n){this._globalHandlers[n.handlerId]=n},i.prototype._initialize=function(){var i=new n.LandmarkFeatureHandler(this._map),t=new n.LabelFeatureHandler(this._map);this.mapFeatureEventEmitters={};this.mapFeatureEventEmitters[n.EventEmitterName.Label]=t;this.mapFeatureEventEmitters[n.EventEmitterName.Landmark]=i;this._srcLayerToHandlerMap={landmark:i,premium:i,transit:i,transit_hd:i,populated_place:t,neighborhood:t,admin_division1:t,country_region:t,park:t,mountain:t,volcano:t};this._clickAsToHandlerMap={lbl:t,lmk:i};this._globalHandlers={};this._disposables.push(i,t)},i.prototype._getHandlerForFeature=function(n){var i=n.properties,r=i&&i["clk-as"],t,u;return r&&(t=this._clickAsToHandlerMap[r]),t||it.clickableByFeatureProperty||(u=n.sourceLayer,t=this._srcLayerToHandlerMap[u]),t},i.prototype._getBaseFeatureAction=function(n,t){for(var e,h,o,i,u,f,r={},s=0,c=n.shapes;s<c.length;s++){var a=c[s],l=a,i=this._getHandlerForFeature(l);i&&(!t||i.dragFeature)&&(r[i.handlerId]||(u=i.getFeatureInfo(l,t),u&&(r[i.handlerId]=[i,u])))}for(e=0,h=Object.keys(this._globalHandlers);e<h.length;e++)(o=h[e],i=this._globalHandlers[o],i&&(!t||i.dragFeature))&&(r[o]||(u=i.getFeatureInfo(n,t),u&&(r[o]=[i,u])));return(f=Object.keys(r),f.length>1&&f.sort(function(n,t){return r[n][1].priority-r[t][1].priority}),f.length>0)?r[f[0]]:[undefined,undefined]},i.prototype._handleMouseClick=function(n,t){var u,i,r,f;this._isActive&&(i=this._handler,r=this._featureInfo,i||(u=this._getBaseFeatureAction(n),i=u[0],r=u[1]),f=!1,i&&r&&(f=i.clickFeature(r,n,t),i.leaveFeature(r,n),this._handler=undefined,this._featureInfo=undefined),f||this._map.mapClicked.invoke(n))},i.prototype._handleMouseDown=function(n){var r;if(this._isActive){var u=this._getBaseFeatureAction(n,!0),t=u[0],i=u[1];t&&(this._map.setUserInteraction({dragPanInteraction:!1}),r=t||this._handler,r&&!r.areSameFeatureInfo(i,this._featureInfo)&&(this._handler&&this._handler.leaveFeature(this._featureInfo,n),t&&i&&(this._canvasContainer.style.cursor="pointer",t.enterFeature(i,n))),this._handler=t,this._featureInfo=i,this._canDrag=!0)}},i.prototype._handleMouseUp=function(n,t){if(t===void 0&&(t=2),this._isActive){var i=this._handler,r=this._featureInfo;this._isDragging&&(this._isDragging=!1,i.dragFeature(r,n,t));this._canDrag&&(this._map.setUserInteraction({dragPanInteraction:!0}),this._canDrag=!1)}},i.prototype._handleMouseMove=function(n){var u,f,e;if(this._isActive&&!this._mapMoving){if(this._canDrag){f=this._handler;e=this._featureInfo;this._isDragging||(this._isDragging=!0,f.dragFeature(e,n,0));f.dragFeature(e,n,1);return}var o=this._canvasContainer,s=this._getBaseFeatureAction(n),r=s[0],t=s[1],i=r||this._handler,h=i===null||i===void 0?void 0:i.areSameFeatureInfo(t,this._featureInfo);h?(u=i.hoverFeature)===null||u===void 0?void 0:u.call(i,t,n):(this._handler&&this._handler.leaveFeature(this._featureInfo,n),r&&t?(o.style.cursor="pointer",this._handler=r,this._featureInfo=t,r.enterFeature(t,n)):this._handler&&(o.style.cursor="",this._handler=undefined,this._featureInfo=undefined))}},i.prototype._handleMouseOut=function(n){this._isActive&&(this._canDrag&&this._handleMouseUp(n,3),this._handler&&(this._handler.leaveFeature(this._featureInfo,n),this._canvasContainer.style.cursor="",this._handler=undefined,this._featureInfo=undefined))},i.prototype._updateShapeData=function(n){return n.shapes=this._rasterHoverDelegate.getBaseMapShapes(n)||n.shapes,n},i}(k);n.BaseMapFeatureDelegate=t}(n||(n={})),function(n){var t=function(){function t(t){this.handlerId=n.EventEmitterName.Label;this._mlMap=t._getMap();this.disposables=[this.onClick=new i,this.onHoverStarted=new i,this.onHoverEnded=new i]}return t.prototype.dispose=function(){this.isDisposed||(f._nullifyClass(this),f._clearDisposables(this.disposables),this.isDisposed=!0)},t.prototype.getFeatureInfo=function(n){var t=n.properties,i=t&&t.id,r=t&&t.name,f=(i===null||i===void 0?void 0:i.indexOf("-"))<0,u;return f&&r&&(u={priority:3,feature:n,text:r,vdpid:i}),u},t.prototype.areSameFeatureInfo=function(n,t){return f.areValuesEqual(n,t)},t.prototype.clickFeature=function(n,t,i){return i?!1:(this.onClick.invoke({event:t,text:n.text,id:"vdpid:".concat(n.vdpid),anchorPoint:n.feature.geometry}),!0)},t.prototype.enterFeature=function(n,t){n&&(n.feature.sourceLayer&&this._mlMap.setFeatureState(n.feature,{hover:!0}),this.onHoverStarted.invoke({event:t,text:n.text,id:"vdpid:".concat(n.vdpid)}))},t.prototype.leaveFeature=function(n){n.feature.sourceLayer&&this._mlMap.setFeatureState(n.feature,{hover:!1});this.onHoverEnded.invoke()},t}();n.LabelFeatureHandler=t}(n||(n={})),function(n){var t=0,u=50,e=function(){function e(t){this._atlasMap=t;this.handlerId=n.EventEmitterName.Landmark;this._mlMap=this._atlasMap._getMap();this.disposables=[this._infobox,this.onClick=new i,this.onHoverStarted=new i,this.onHoverEnded=new i,]}return e.prototype.setHelpers=function(n,t){this._processor=n;this._entityCreator=t},e._getTransitStop=function(n){var i=n.transitJson,r,t;return i&&(t=JSON.parse(i),r=t.stops&&t.stops[0]),r},e.prototype.dispose=function(){this.isDisposed||(f._clearDisposables(this.disposables),f._nullifyClass(this),this.isDisposed=!0)},e.prototype.getFeatureInfo=function(n){var i,t=n.properties,o=t&&(t["lmk-ypid"]||t["lmk-tj"]),r,u=n.layer&&n.layer.id,f,e;return o&&u!=="lmk_hov"&&(f=n.bbox,e=(i=n.geometry)===null||i===void 0?void 0:i.coordinates,r={priority:2,feature:n,name:t.name,layerId:u||"",bbox:f,position:e,ypid:t["lmk-ypid"]||undefined,transitJson:t["lmk-tj"]||undefined,isCoupoi:y.landmarkDeals&&!!t["lmk-coupoi"],bucket:t.bkt}),r},e.prototype.areSameFeatureInfo=function(n,t){return f.areValuesEqual(n,t,["feature"])},e.prototype.clickFeature=function(n,t,i){var u,r,f;return i?!1:(u=n.ypid,r=e._getTransitStop(n),u&&n.layerId.indexOf("lmk_3d")<0?this.onClick.invoke({event:t,type:"business",name:n.name,id:u,layerId:n.layerId,position:n.position||t.position,bucket:n.bucket}):r&&this.onClick.invoke({event:t,type:"transit",name:r.name,id:r.id,layerId:n.layerId,position:n.position||t.position,bucket:n.bucket}),f=n.isCoupoi?"LD":"L",this._log(f,"C",n),!0)},e.prototype.enterFeature=function(i,r){var f=this,o,s,c,h;i&&i.layerId.indexOf("lmk_3d")<0&&(this._hoverStartTime=Date.now(),this._infobox&&(clearTimeout(this._infoboxCloseDelayHandle),this._infobox.setOptions({visible:!1,delayTime:0,animationDuration:0})),o=e._getTransitStop(i),o?(s=n.InfoboxContentCreator.createTransitContent(o),(a===null||a===void 0?void 0:a.isEnabled)?(h=function(){var t=f._getInfobox(s,i.position||r.position);t.setOptions({visible:!0,pixelOffset:[5,-10]});n.InfoboxInstrumentation.logOpen(""+o.id,o.name,!1,s);t.infoboxClicked.addOne(function(){n.InfoboxInstrumentation.logClick(""+o.id,o.name,!1)})},this._infoboxDelayHandle=b.setTimeout(h,u)):(c=this._getPopup(s,i.position||r.position),c.open()),this.onHoverStarted.invoke({event:r,type:"transit",name:o.name,id:o.id,layerId:i.layerId,position:i.position||r.position,bucket:i.bucket})):((a===null||a===void 0?void 0:a.isEnabled)&&(h=function(){s=n.InfoboxContentCreator.createSimpleContent(i.name);var e=i.position||r.position,u=f._getInfobox(s,e),o=ft.getAdjustedAnchor(f._atlasMap,{pixelOffset:[5,-15],position:e}),h=o.anchor,c=o.pixelOffset;u.setOptions({anchor:h,visible:!0,pixelOffset:c,animationDuration:i.isCoupoi?0:t});n.InfoboxContentCreator.createLandmarkContent(i).then(function(t){var o=u.getOptions().position,r;w.Position.areEqual(o,e)&&(r=f._entityCreator&&f._entityCreator.createFromFeatureInfo(i),!i.isCoupoi&&f._processor&&r&&(t=f._processor.preProcessContent(t,r,u)),t&&u.getOptions().visible&&(u.setOptions({delayTime:0,htmlContent:t,animationDuration:0,entity:r}),i.isCoupoi||(f._postProcessingHandle=b.setTimeout(function(){f._processor&&r&&f._processor.postProcessContent(r,u)})),n.InfoboxInstrumentation.logOpen(i.ypid,i.name,!0,t),u.infoboxClicked.addOne(function(){n.InfoboxInstrumentation.logClick(i.ypid,i.name,!0)})))})},this._infoboxDelayHandle=b.setTimeout(h,u)),this.onHoverStarted.invoke({event:r,type:"business",name:i.name,id:i.ypid,layerId:i.layerId,position:i.position||r.position,bucket:i.bucket})),it.landmarkHoverState&&i.feature.sourceLayer==="landmark"&&(this._updateHoverLayer(i),this._mlMap.setFeatureState(i.feature,{hover:!0})))},e.prototype.leaveFeature=function(i){var f=this,r;this._infobox&&(this._infoboxCloseDelayHandle=b.setTimeout(function(){f._infobox.setOptions({visible:!1,animationDuration:t})},u));this._popup&&this._popup.close();it.landmarkHoverState&&i.feature.sourceLayer==="landmark"&&i.layerId.indexOf("lmk_3d")<0&&this._mlMap.setFeatureState(i.feature,{hover:!1});this.onHoverEnded.invoke();clearTimeout(this._infoboxDelayHandle);n.InfoboxContentCreator.abortContentRequests();i&&(r=Date.now()-this._hoverStartTime,this._log("L","H",i,r))},e.prototype._updateHoverLayer=function(n){var i=n===null||n===void 0?void 0:n.feature,t,r,u;i&&(t=this._hoverLayer,t||(r=["concat","hov-",["get","bkt"]],y.landmarkDeals&&r.push(["case",["has","lmk-coupoi"],"-coupoi-dealsTag",""]),t=new nt.SymbolLayer(i.source,"lmk_hov",{iconOptions:{image:r,allowOverlap:!0,anchor:"center",ignorePlacement:!0,offset:[1,1],opacity:["case",["boolean",["feature-state","hover"],!1],1,0]},sourceLayer:i.sourceLayer}),this._atlasMap.layers.add(t),this._hoverLayer=t),u=i.layer,t.setOptions({iconOptions:{offset:u.layout["icon-offset"],size:u.layout["icon-size"]}}))},e.prototype._getInfobox=function(i,r){var u=this;return this._infobox?this._resetInfobox():(this._infobox=new n.RichMapsInfobox(this._atlasMap,{anchor:"bottom-left"}),this._infobox.infoboxEnter.add(function(){clearTimeout(u._infoboxCloseDelayHandle)})),this._infobox.setOptions({htmlContent:i,position:r,animationDuration:t}),this._infobox},e.prototype._getPopup=function(n,t){if(!this._popup)this._popup=new atlas.Popup({closeButton:!1,showPointer:!0}),this._popup.attach(this._atlasMap);return this._popup.setOptions({content:n,position:t}),this._popup},e.prototype._log=function(n,t,i,u,f){var h=r.logger,o=i.ypid,c=i.position,e=null,s;o&&(e={ID:o,Z:this._atlasMap.getCamera().zoom,L:c,CP:i.isCoupoi?"1":"0"},u&&(e.HD=u),f&&(e.dealsUrl=f));s={feature:n,action:t,data:e};h.logObject(s)},e.prototype._resetInfobox=function(){[this._infoboxDelayHandle,this._postProcessingHandle,this._infoboxCloseDelayHandle].forEach(function(n){clearTimeout(n)});var n=this._infobox;n&&[n.infoboxClicked,n.infoboxEnter,n.infoboxLeave].forEach(function(n){return n.reset()})},e}();n.LandmarkFeatureHandler=e}(n||(n={})),function(n){var t=function(t){function i(n){var i=t.call(this,n)||this,f;return i._onStyleChanged=function(){var n,f,r,t;if(i._clickableRegionUrl=null,n=i._map._getMap().getStyle().sources,f=i._map.getStyle().style.toLowerCase(),f!=="ordnancesurvey")for(r in n)if(t=n[r],n[r].rasterHoverSource&&t.tiles&&t.tiles.length>0){i._clickableRegionUrl=t.tiles[0].replace("raster://","https://").replace("{quadkey}","{quadkey}.json")+"&output=json&jsonp={callback}&jsonso={jsonso}";u.testHooksEnabled&&(i._clickableRegionUrl+="&overrideBag=V9/Service/ClickableRegions.js");break}i._disabled=!i._clickableRegionUrl;i._lastHitHoverRegion=null;i._lastMousePosition=null;i._clearDebugPolygons()},i._onMouseMove=function(n){if(!i._paused&&!i._disabled){i._lastMousePosition=n.position;var t=i._getTileDataAtMousePosition();i._updateDataStore(t);i._hitTest(t)}},i._onMapMoveEnd=function(){i._paused=!1},i._onMapMoveStart=function(){i._lastHitHoverRegion=null;i._lastMousePosition=null;i._paused=!0},i._getTileDataAtMousePosition=function(n){var u,f=n||i._lastMousePosition;if(f){var t=Math.round(i._map.getCamera().zoom)-1,r=tt.tileXYFromLocation(f,t),e=tt.quadkeyFromTileXY(r.x,r.y,t);u={tileLod:t,tileXY:r,quadKey:e}}return u},i._clearDebugPolygons=function(){i._debugPolygonRendered={};i._debugPolygonDataSource&&i._debugPolygonDataSource.clear()},f=r.DeviceInfo,f.renderingMode===2&&y.rasterHoverEnabled&&(i._pendingRequest={},i._debugPolygonRendered={},i._lruDataCache=new st(15),i._onStyleChanged(),i._attachEvents(),n.mapLoaded.then(function(){var t=i._getTileDataAtMousePosition(n.getCamera().center);i._updateDataStore(t)})),i}return c(i,t),i.prototype.getBaseMapShapes=function(n){var t=n.position;return t&&this._lastHitHoverRegion&&this._lastMousePosition&&t[0]===this._lastMousePosition[0]&&t[1]===this._lastMousePosition[1]?ut(ut([],n.shapes,!0),[this._lastHitHoverRegion.mapFeature],!1):null},i.prototype.dispose=function(){t.prototype.dispose.call(this);this._lruDataCache&&this._lruDataCache.clear();f._nullifyClass(this)},i.prototype._attachEvents=function(){this._disposables.push(e.add(this._map,"stylechanged",this._onStyleChanged),e.add(this._map,"mousemove",this._onMouseMove),e.add(this._map,"movestart",this._onMapMoveStart),e.add(this._map,"moveend",this._onMapMoveEnd),e.add(this._map,"zoomend",this._clearDebugPolygons))},i.prototype._updateDataStore=function(n){var i=this,t;n&&(t=n.quadKey,this._pendingRequest[t]||this._lruDataCache.getItem(t)||(this._pendingRequest[t]=!0,v.downloadJsonp(this._clickableRegionUrl.replace("{quadkey}",t),"RasterHoverDelegate",function(r){i._parseResponse(r,n.tileXY,n.tileLod);delete i._pendingRequest[t];i._lruDataCache.addItem(t,r)},function(){delete i._pendingRequest[t]})))},i.prototype._hitTest=function(n){var i,r,e,o,t,u,f;if(n&&(i=n.quadKey,r=this._lruDataCache.getItem(i),r&&(y.tileBoundary&&this._drawDebugBoundary(i),e=r.hrs,o=this._lastHitHoverRegion&&this._lastHitHoverRegion.boundingBoxes,!this._isInsideHoverRegion(o,this._lastMousePosition))))for(this._lastHitHoverRegion=null,t=0,u=e;t<u.length;t++)if(f=u[t],this._isInsideHoverRegion(f.boundingBoxes,this._lastMousePosition)){this._lastHitHoverRegion=f;break}},i.prototype._isInsideHoverRegion=function(n,t){var i,r,u;if(n)for(i=0,r=n;i<r.length;i++)if(u=r[i],atlas.data.BoundingBox.containsPosition(u,t))return!0;return!1},i.prototype._parseResponse=function(n,t,i){var o,y,u,s,r,h,f,c,p,l,e,a,v;if(n)for(o=tt.tileXYToPixelXY(t,1024),y=n.hrs,u=0,s=y;u<s.length;u++)if(r=s[u],r.brs){for(h=[],f=0,c=r.brs;f<c.length;f++){for(p=c[f],l=[],e=0,a=p;e<a.length;e++)v=a[e],l.push(tt.pixelXYToLatLong({x:o.x+v.x,y:o.y+v.y},i+2));h.push(atlas.data.BoundingBox.fromLatLngs(l))}r.boundingBoxes=h;r.mapFeature=this._getBaseFeature(r);delete r.brs;delete r.bmv}},i.prototype._getBaseFeature=function(t){var r=t.id,u=t.name,i,f;return t.type==="label"?i={id:r,name:u,"clk-as":n.EventEmitterName.Label,bkt:-1}:(t.type==="yp"||t.type==="transit")&&(f=t.transitdata&&JSON.stringify(t.transitdata),i={id:r,name:u,"clk-as":n.EventEmitterName.Landmark,bkt:-1,"lmk-sc":t.type==="yp"?1:2,"lmk-tj":f,"lmk-ypid":t.ypid}),new atlas.data.Feature(null,i,t.id)},i.prototype._drawDebugBoundary=function(){},i}(k);n.RasterHoverDelegate=t}(n||(n={})),function(n){var t=function(n,t,i){var u=r.logger,f={feature:"FLO",action:n,data:{component:"FOPLR",TS:i,videoUrl:t}};u.logObject(f)},e=function(r){function e(t){var u=r.call(this,t)||this,e,o;return u.onFeedbackBtnClick=new i,u.onOpenBtnClick=new i,u.onCloseBtnClick=new i,u.onViewerOpen=new i,u.onViewerClose=new i,e=u.flyoverButtonControl=new n.FlyoverButtonControl(t),t.controls.add(e,{position:atlas.ControlPosition.NonFixed}),l.isRender3DEnabled&&(d===null||d===void 0?void 0:d.isEnabled)?(o=f._getUrlParam(window.location,"lmk3ddataver",!1),o?u.getFlyovers(o):v.downloadGeneric(l.render3DDataVersionUrl,"flyoverdata",function(n){u.getFlyovers(n)})):rt.resolveBySourceKey("FlyoverData",function(){e.update(t)}),u._disposables=[e.onButtonClick.add(function(t){var r=t.flyoverUrl.split(":",2),i=r[0];switch(i){case"video":rt.resolveBySourceKey("AzureMediaPlayerJs",function(){u.onOpenBtnClick.invoke();u.openPlayer(t.flyoverUrl).catch(function(){u.onCloseBtnClick.invoke()})});break;case"render":u.onOpenBtnClick.invoke();u.openPlayer(t.flyoverUrl).catch(function(){u.onCloseBtnClick.invoke()});break;default:throw new Error('Unknown playback mode: "'.concat(i,'"'));}}),e,u.onCloseBtnClick,u.onFeedbackBtnClick,u.onOpenBtnClick],u}return c(e,r),e.prototype.dispose=function(){this._isDisposed||this._map.controls.remove(this.flyoverButtonControl);r.prototype.dispose.call(this)},e.prototype.getControl=function(){return this.flyoverButtonControl},e.prototype.sendCloseEvent=function(){var t;(t=this.player)===null||t===void 0?void 0:t.onCloseBtnClick.invoke(new MouseEvent("click"));n.Map3DShared.close()},e.prototype.getFlyovers=function(t){var i=this;n.getFlyoverReferences(t,function(t){n.flyoverData=t;i.flyoverButtonControl.update(i._map)})},e.prototype.openPlayer=function(t){var i=this;return this._openDisposables&&this._close("ERR"),new Promise(function(r,f){var e,o,h,c,a,s;try{if(!t)throw new Error("Flyover player location must be set");if(i.lastPlayerTypedUrl=t,e=t.split(":",2),e.length!==2)throw new Error('Flyover player location badly formed: "'.concat(t,'"'));if(o=e[1],!o)throw new Error("Flyover player location id may not be blank");h=e[0];i.lastPlayerOpenTime=Date.now();switch(h){case"video":c=l.videoUrlFormat.replace("{fileLocation}",o);a=new n.FlyoverVideoPlayerControl(c,u.isMapsVertical);i.openPlayerControl(a);r();i.onViewerOpen.invoke();return;case"render":s=n.Map3DShared.instance;s.open(i._map,n.Map3DModeReference.Flyover,{flyoverId:o});i._openDisposables=[s.onCloseBtnClick.add(function(n){i._close("X");i.onCloseBtnClick.invoke(n)}),s.onFeedbackBtnClick.add(function(n){i._close("F");i.onFeedbackBtnClick.invoke(n)})];r();i.onViewerOpen.invoke();return;default:throw new Error('Unknown playback mode: "'.concat(h,'"'));}}catch(v){f(v)}})},e.prototype.openPlayerControl=function(t){var i=this;this.player&&this._close("PERR");n.fullScreen(!0);this.player=t;this._map.controls.add(t);t.play();this._openDisposables=[t,t.onCloseBtnClick.add(function(n){i._close("PX");i.onCloseBtnClick.invoke(n)})];t.onFeedbackBtnClick&&this._openDisposables.push(t.onFeedbackBtnClick.add(function(n){i._close("PF");i.onFeedbackBtnClick.invoke(n)}))},e.prototype._close=function(i){if(this._openDisposables){var r=this.lastPlayerOpenTime?Date.now()-this.lastPlayerOpenTime:undefined;this.lastPlayerOpenTime=undefined;t("CLSM",this.lastPlayerTypedUrl,r);this.player&&(this._map.controls.remove(this.player),this.player=undefined,n.fullScreen(!1));this._openDisposables.forEach(function(n){return n.dispose()});this._openDisposables=undefined;this.onViewerClose.invoke();this.lastPlayerTypedUrl=undefined}},e}(k);n.FlyoverDelegate=e}(n||(n={})),function(n){n.decodeFlyoverReferences=function(n){return JSON.parse(n,function(n,t){switch(n){case"n":return this.name=t,undefined;case"c":return this.coordinate=t,undefined;case"b":return this.bounds=t,undefined;case"u":return this.url=t,undefined;case"r":return this.render=t,undefined;default:return t}})};n.getFlyoverReferences=function(t,i){var r=l.render3DAllUrlFormat.replace("{version}",t);v.downloadGeneric(r,"flyovers",function(t){var r=n.decodeFlyoverReferences(t);i(r)})}}(n||(n={})),function(n){var t;(function(t){var i=atlas.data;t.getFlyoverItems=function(t){var o=[],s=l.isRender3DEnabled?n.flyoverData:r.FlyoverData,u,e,f,h;if(s)for(u=0,e=s;u<e.length;u++)f=e[u],h=[f.coordinate[1],f.coordinate[0]],i.BoundingBox.containsPosition(t,h)&&o.push(f);return o}})(t=n.FlyoverService||(n.FlyoverService={}))}(n||(n={})),function(n){var o='\n        <div class="bm_videoLinks">\n            <ul><\/ul>\n        <\/div>\n        <div class="bm_flyoverBtnContent">\n            <span class="bm_flyoverBadge"><\/span>\n            <span class="bm_flyoverText"><\/span>\n        <\/div>\n    ',h='<li tabindex="0" ><div data-url="{url}">{name}<\/div><\/li>',t=function(n,t,i){var u=r.logger,e={feature:"FLO",action:n,data:{component:"FOBTN",boundingBox:f.convertMapBoundsOrder(i.bounds,0).toString(),zoom:f.convertZoom(i.zoom,0),videoUrl:t}};u.logObject(e)},a=function(a){function v(n){var t=a.call(this)||this;return t._map=n,t.useRender3D=undefined,t.onButtonClick=new i,t.disposables=[e.add(n,"moveend",function(){t.update(n)}),t.onButtonClick],t}return c(v,a),v.getTypedUrl=function(n,t){if(t){if(n.render)return"render:".concat(n.render)}else if(n.url)return"video:".concat(n.url);return undefined},v.prototype.update=function(i){var it=this,tt,o,b,c,k,d,a,g,e,f,nt,y;this.useRender3D===undefined&&(l.isRender3DEnabled?r.DeviceInfo.webgl2Supported?(tt=!!u.dynamicProperties.sessionKey,tt?this.useRender3D=!0:(console.warn("3D rendering not supported because GlobalConfig.dynamicProperties.sessionKey is not defined"),this.useRender3D=!1)):(console.warn("3D rendering not supported because no WebGL2 support"),this.useRender3D=!1):this.useRender3D=!1);this.flyoverText.innerText=this.useRender3D?s.L_3DLandmark_Flyover_Render:s.L_3DLandmark_Flyover_Video;var p=i.getCamera(),rt=p.zoom,ut=p.bounds,w=n.FlyoverService.getFlyoverItems(ut);if(this.flyoverUrl=undefined,w)for(o=0,b=w;o<b.length;o++)if(e=b[o],f=v.getTypedUrl(e,this.useRender3D),f){this.flyoverUrl=f;break}if(c=this.flyoverUrl&&rt>=l.minLodToShowButton,this.buttonContainer.style.display=c?"block":"none",c){for(k="",d=0,a=0,g=w;a<g.length;a++)e=g[a],f=v.getTypedUrl(e,this.useRender3D),f&&(k+=h.replace("{url}",f).replace("{name}",e.name),++d);for(this.itemListContainer.innerHTML=k,this.flyoverBadge.innerText=d.toString(),nt=this.itemListContainer.getElementsByTagName("li"),y=0;y<nt.length;y++)nt[y].addEventListener("keydown",function(n){(n.keyCode===13||n.keyCode===32)&&it._onFlyoverListItemClick(n)});this.isVisible||t("I",this.flyoverUrl,p)}this.isVisible=c},v.prototype.dispose=function(){this.isDisposed||(f._clearDisposables(this.disposables),this.isDisposed=!0)},v.prototype.onAdd=function(n){var i=this,s=function(){return i._invokeFlyoverButtonClick(i.flyoverUrl)},r=function(n){n.type==="mouseover"?(clearTimeout(i.timerHandle),i.itemListContainer.style.display="block"):i.timerHandle=setTimeout(function(){i.itemListContainer.style.display="none"},250)},h=function(n){n.currentTarget.contains(n.relatedTarget)||(i.itemListContainer.style.display="none")},c=function(n){(n.keyCode===13||n.keyCode===32)&&(i.itemListContainer.style.display="block",i.itemListContainer.firstElementChild.focus())},t=this.buttonContainer=this.buildContainer(n,atlas.ControlStyle.auto),f,e;return t.className="bm_flyoverButton",t.tabIndex=0,(u.isMapsVertical||u.dynamicProperties.isMapsOverlay)&&(t.className+=" vertical"),t.innerHTML=o,t.addEventListener("mouseover",r),t.addEventListener("mouseout",r),t.addEventListener("focusout",h),t.addEventListener("keydown",c),f=t.querySelector(".bm_videoLinks"),f.addEventListener("click",function(n){return i._onFlyoverListItemClick(n)}),e=t.querySelector(".bm_flyoverBtnContent"),e.addEventListener("click",s),this.itemListContainer=t.querySelector(".bm_videoLinks ul"),this.flyoverBadge=t.querySelector(".bm_flyoverBadge"),this.flyoverText=t.querySelector(".bm_flyoverText"),t},v.prototype.getRootElement=function(){return this.buttonContainer},v.prototype._invokeFlyoverButtonClick=function(n){t("C",n,this._map.getCamera());var i={flyoverUrl:n};this.onButtonClick.invoke(i)},v.prototype._onFlyoverListItemClick=function(n){var t=n.type==="click"?n.target:n.target.firstElementChild,i=t.getAttribute("data-url");this._invokeFlyoverButtonClick(i)},v}(atlas.control.ControlBase);n.FlyoverButtonControl=a}(n||(n={})),function(n){var t='\n        <button class="bm_btnFeedback"><\/button>\n        <button class="bm_btnClose"><\/button>\n        {display}\n    ',r=function(n){function r(t,r){var u=n.call(this)||this;return u.sourceUrl=t,u.enableFeedback=r,u.onCloseBtnClick=new i,u.disposables=[u.onCloseBtnClick],r&&(u.onFeedbackBtnClick=new i,u.disposables.push(u.onFeedbackBtnClick)),u}return c(r,n),r.prototype.onAdd=function(n){var f=this,e=function(n){f.onFeedbackBtnClick.invoke(n)},o=function(n){f.onCloseBtnClick.invoke(n)},i=this._containerElement=this.buildContainer(n,atlas.ControlStyle.auto),u,r;return i.className="bm_flyoverVideo",i.innerHTML=t.replace("{display}",this.getContainerHtml()),u=i.querySelector(".bm_btnClose"),u.addEventListener("click",o),this.enableFeedback?(r=i.querySelector(".bm_btnFeedback"),r.addEventListener("click",e),r.style.display="inline-block",this._focusStartElement=r):this._focusStartElement=u,i},r.prototype.play=function(){var i=this,t,n;this.playInternal()&&(n=(t=this._containerElement)===null||t===void 0?void 0:t.querySelector(".vjs-fullscreen-control.vjs-control.vjs-button"),n===null||n===void 0?void 0:n.addEventListener("blur",function(){i._focusStartElement.focus()}))},r.prototype.ready=function(){this._focusStartElement.focus()},r.prototype.dispose=function(){this.isDisposed||(f._clearDisposables(this.disposables),this.isDisposed=!0)},r}(atlas.control.ControlBase);n.FlyoverPlayerControl=r}(n||(n={})),function(n){var t='<video id="{videoID}" width="100%" height="100%" class="azuremediaplayer amp-default-skin" autoplay><\/video>',i=function(n){function i(){var t=n!==null&&n.apply(this,arguments)||this;return t._componentName="FOPLR",t}return c(i,n),i.prototype.getContainerHtml=function(){return this.videoID="flyover_"+Date.now(),t.replace("{videoID}",this.videoID)},i.prototype.playInternal=function(){var t=this,n;return typeof amp=="undefined"||!amp||!this.sourceUrl?!1:(amp.options.flashSS.swf=l.flashSsUrl,amp.options.silverlightSS.xap=l.silverlightSsUrl,n=amp(this.videoID,{techOrder:["azureHtml5JS","html5","flashSS","html5FairPlayHLS","silverlightSS"],autoplay:!0,controls:!0}),n.src([{src:this.sourceUrl,type:"application/vnd.ms-sstr+xml"}]),n.ready(function(){this.play()}),n.ready(function(){return t.ready()}),!0)},i}(n.FlyoverPlayerControl);n.FlyoverVideoPlayerControl=i}(n||(n={})),function(n){var t;(function(n){n.Label="lbl";n.Landmark="lmk"})(t=n.EventEmitterName||(n.EventEmitterName={}))}(n||(n={})),function(n){var t=function(n,t,i,u){var f=r.logger,e={feature:"LMK3D",action:n,data:{LN:t,CTX:i,TS:u}};f.logObject(e)},o=function(n){var t=document.createElement("img");return t.crossOrigin="anonymous",n.startsWith("/")&&(n=u.dynamicProperties.origin+n),t.src=n,t},l=48,a=6,y=7,p="DRTLNK",w=function(r){function w(t){var u=r.call(this,t.getAzureMap&&t.getAzureMap()||t)||this;return u.onFeedbackBtnClick=new i,u.onCloseBtnClick=new i,u.onIconClick=new i,u.onDirectLink=new i,u.onViewerOpen=new i,u.onViewerClose=new i,u._open=!1,u._htmlElement=document.querySelector("html"),u._disposables=[u.onCloseBtnClick,u.onFeedbackBtnClick,u.onIconClick,u.onDirectLink],u.onIconClick.add(function(){n.fullScreen(!0)}),u.onDirectLink.add(function(){n.fullScreen(!0)}),u.onCloseBtnClick.add(function(){n.fullScreen(!1)}),u._map.mapLoaded.then(function(){u._initialize();(h===null||h===void 0?void 0:h.enableShare)&&window.location.search.indexOf("lmk3d=")>=0&&u._openDirectLink()}),u}return c(w,r),w.prototype.dispose=function(){r.prototype.dispose.call(this)},w.prototype._updateLayerVisibility=function(){var t,f,s,i,e,h;if(this._defaultLayers&&this._map){var o=this._map._getMap(),r=o.getStyle().metadata,n=r===null||r===void 0?void 0:r.layerIndex,c=((n===null||n===void 0?void 0:n.defaultBusinessLandmarks)||[]).concat((n===null||n===void 0?void 0:n.retiredBusinessLandmarks)||[]),u=!1;for(t=0,f=c;t<f.length;t++)if(s=f[t],u=o.getLayoutProperty(s,"visibility")==="visible",u)break;for(i=0,e=this._defaultLayers;i<e.length;i++)h=e[i],h.setOptions({visible:u})}},w.prototype._initialize=function(){var n=this,t=this._map.sources.getById("bing-mvt"),i,r;t?(i=function(t,i){return t.width=l,t.height=l,n._map.imageSprite.add(i,t)},r=new Promise(function(n){var t=o(h.defaultIconResource),r=o(h.hoverIconResource);if(!t||!r){n(!1);return}var u=new Promise(function(n){t.onload=function(){i(t,"lmk-3d").then(function(){return n()})}}),f=new Promise(function(n){r.onload=function(){i(r,"lmk-3d-hover").then(function(){return n()})}}),e=[u,f];Promise.all(e).then(function(){return n(!0)})}),r.then(function(i){if(i){var r=n._defaultLayers=[new nt.SymbolLayer(t,"lmk_3d_default",{sourceLayer:"landmark",minZoom:11,filter:["==","lmk-has3d","1"],iconOptions:{allowOverlap:!1,ignorePlacement:!0,image:"lmk-3d",offset:h.iconOffsetDefault,size:.7}}),new nt.SymbolLayer(t,"lmk_3d_premium_default",{sourceLayer:"premium",minZoom:12,filter:["==","lmk-has3d","1"],iconOptions:{allowOverlap:!1,ignorePlacement:!0,image:"lmk-3d",offset:h.iconOffsetPremium,size:.7}})];n._map.layers.add(r);n._map.events.add("stylechanged",function(){return n._updateLayerVisibility()});n._updateLayerVisibility();n._map.createDataSource("lmk_hover_ds").then(function(t){n._hoverDataSource=t;var i=n._hoverLayer=new nt.SymbolLayer(t,"lmk_3d_hover",{iconOptions:{allowOverlap:!1,ignorePlacement:!0,image:"lmk-3d-hover",size:.7}});n._map.layers.add(i)});n._disposables.push(e.add(n._map,"mouseenter",r,function(t){return n._hoverShape(n._getShapeData(t))}),e.add(n._map,"mouseleave",r,function(){return n._hoverShape()}),e.add(n._map,"mousemove",r,function(t){return n._hoverShape(n._getShapeData(t))}),e.add(n._map,"click",r,function(t){return n._onClicked(t)}))}})):this._map.events.addOnce("stylechanged",function(){return n._initialize()})},w.prototype.sendCloseEvent=function(){n.Map3DShared.close()},w.prototype._getSessionKey=function(){var n=u.dynamicProperties.sessionKey;if(n===undefined)throw new Error("SessionKey undefined");return n},w.prototype._openDirectLink=function(){var t,r=f._getUrlParam(window.location,"lmk3d",!1),n;if(r&&(n=r.split("|"),n.length===a||n.length===y)){var i=parseFloat(n[0]),u=parseFloat(n[1]),e=parseFloat(n[2]),o=parseFloat(n[3]),s=parseFloat(n[4]),h=n[5],c=(t=n[6])!==null&&t!==void 0?t:h,l=ot.normalizeLongitude(u);i>=-90&&i<=90&&!isNaN(l)&&!isNaN(e)&&!isNaN(o)&&!isNaN(s)&&(this.onDirectLink.invoke(),this._openViewer({pivotLat:i,pivotLong:u,elevation:e,radius:o,pitch:s,name:h,ypid:c},p))}},w.prototype._openViewer=function(i,r){var u=this,e,o,f;this._openDisposables&&this._close("ERR");t("C",i.ypid,r);this._lastViewerOpenTime=Date.now();this._lastViewerLandmarkId=(e=i.ypid)!==null&&e!==void 0?e:i.name;o={viewLatitude:i.pivotLat,viewLongitude:i.pivotLong,viewAltitude:i.elevation,targetCameraRadius:i.radius,targetCameraTilt:i.pitch,targetCameraLandmarkName:i.name,ypid:i.ypid?"YN".concat(i.ypid):undefined};f=n.Map3DShared.instance;f.open(this._map,n.Map3DModeReference.Landmark,o);this._openDisposables=[f.onCloseBtnClick.add(function(n){u._close("X");u.onCloseBtnClick.invoke(n)}),f.onFeedbackBtnClick.add(function(n){u._close("F");u.onFeedbackBtnClick.invoke(n)})];this.onViewerOpen.invoke()},w.prototype._close=function(i){var u,r;(this._open=!1,this._openDisposables)&&(this.onViewerClose.invoke(),u=this._openDisposables,this._openDisposables=undefined,u.forEach(function(n){return n.dispose()}),r=this._lastViewerOpenTime?Date.now()-this._lastViewerOpenTime:undefined,this._lastViewerOpenTime=undefined,r&&this._lastViewerLandmarkId&&(t("C",this._lastViewerLandmarkId,"CLS_MDL",r),this._lastViewerLandmarkId=undefined),this._htmlElement.style["overscroll-behavior"]="",n.fullScreen(!1))},w.prototype._onClicked=function(t){var r=this,f=this._getShapeData(t),i=f===null||f===void 0?void 0:f.ypid,e;i&&!this._open&&(this._open=!0,e=h.backendUrlFormat.replace("{origin}",u.dynamicProperties.origin).replace("{ypid}",i),v.downloadJson(e,null,function(u){r.onIconClick.invoke(t);u.ypid=i;r._openViewer(u,"ICON")},function(){r._open=!1}))},w.prototype._hoverShape=function(n){var r=this,u,f,e,i=n===null||n===void 0?void 0:n.feature,o,c;if(i!==this._hoveredFeature&&(i===null||i===void 0?void 0:i.id)!==((u=this._hoveredFeature)===null||u===void 0?void 0:u.id)){if((f=this._flyout)===null||f===void 0?void 0:f.close(),this._hoverDataSource.clear(),window.clearTimeout(this._hoveredTimer),!(n===null||n===void 0?void 0:n.position)){this._hoveredFeature=undefined;return}this._hoveredFeature=i;o=i.sourceLayer==="premium"?h.iconOffsetPremium:h.iconOffsetDefault;c=i.sourceLayer==="premium"?h.popupOffsetPremium:h.popupOffsetDefault;(e=this._hoverLayer)===null||e===void 0?void 0:e.setOptions({iconOptions:{offset:o}});this._hoverDataSource.add(i);this._hoveredTimer=b.setTimeout(function(){r._hoveredTimer=undefined;var f=s.L_Landmark3D_Flyout_Text_Format.replace("{name}",n.name),u={content:'<div class="bm_3dlandmark_flyout">'.concat(f,"<\/div>"),pixelOffset:c,position:n.position,closeButton:!1,showPointer:!1},i=r._flyout;i?i.setOptions(u):(i=r._flyout=new atlas.Popup(u),i.attach(r._map));i.open();t("H",n.ypid,"ICON")},200)}},w.prototype._getShapeData=function(n){var r,u=n.shapes,f,t,i,e;return u&&u.length&&(t=u[0],i=t.properties,i["lmk-ypid"]&&(e=(r=t.geometry)===null||r===void 0?void 0:r.coordinates,f={feature:t,name:i.name,ypid:i["lmk-ypid"],position:e})),f},w}(k);n.Landmarks3DDelegate=w}(n||(n={})),function(n){n.TMap3D="map3D";var t=function(n,t){var i=r.logger,u={feature:n.feature,action:n.action,TS:t,data:n.data};i.logObject(u)},u=function(){function n(){}return n.prototype.onLog=function(n){var i=map3DBundle.Map3DLogHelpers.createLogDataFromEvent(n);i&&t(i)},n}(),e=function(){function r(){this.onFeedbackBtnClick=new i;this.onCloseBtnClick=new i;this.onViewerOpen=new i;this._disposables=[];this._htmlElement=document.querySelector("html")}return Object.defineProperty(r,"instance",{get:function(){return r._instance||(r._instance=new r),r._instance},enumerable:!1,configurable:!0}),Object.defineProperty(r,"haveInstance",{get:function(){return!!r._instance},enumerable:!1,configurable:!0}),r.prototype.open=function(t,i,r){var f=this;this._viewerSettings&&this._close();this._desiredViewerSettings={map:t,modeReference:i,options:r};rt.resolveBySourceKey("Map3DControl",function(){var i,t;if(f._desiredViewerSettings){i=f._viewerSettings=f._desiredViewerSettings;f._desiredViewerSettings=undefined;n.fullScreen(!0);try{t=f._viewer=new n.Map3DViewerControl(d,i.modeReference,i.options,new u);f.lastViewerOpenTime=Date.now();i.map.controls.add(t);f._disposables.push(t);f._disposables.push(t.onCloseBtnClick.add(function(t){f._close();f.onCloseBtnClick.invoke(t)}));f._disposables.push(t.onFeedbackBtnClick.add(function(t){f._close();f.onFeedbackBtnClick.invoke(t)}))}catch(r){f.lastViewerOpenTime=undefined;n.fullScreen(!1);throw r;}f._htmlElement.style["overscroll-behavior"]="none";f.onViewerOpen.invoke()}})},r.close=function(){var t,i=r._instance;i&&((t=i._viewer)===null||t===void 0?void 0:t.onCloseBtnClick.invoke(new MouseEvent("click")))},r.prototype._close=function(){var i,r,u;u=this.lastViewerOpenTime?Date.now()-this.lastViewerOpenTime:undefined;this.lastViewerOpenTime=undefined;t({feature:"MAP3D",action:"CLSM",data:{CTX:"BUTTON"}},u);this._desiredViewerSettings=undefined;this._viewer&&((r=(i=this._viewerSettings)===null||i===void 0?void 0:i.map)===null||r===void 0?void 0:r.controls.remove(this._viewer),this._viewer=undefined);this._viewerSettings=undefined;this._htmlElement.style["overscroll-behavior"]="";n.fullScreen(!1);f._clearDisposables(this._disposables)},r}();n.Map3DShared=e}(n||(n={})),function(n){var o={"{shareButtonTitle}":s.L_3DLandmark_Share_Button_Tooltip,"{shareButtonAriaLabel}":s.L_3DLandmark_Share_Button_Aria_Label,"{copyUrlButtonText}":s.L_3DLandmark_Copy_Button_Text,"{sharePanelCloseText}":s.L_3DLandmark_Share_Panel_Close,"{copyLinkSuccessText}":s.L_3DLandmark_Copy_Link_Success,"{feedbackButtonTitle}":s.L_3DLandmark_Feedback_Button_Tooltip,"{feedbackButtonAriaLabel}":s.L_3DLandmark_Feedback_Button_Aria_Label,"{closeButtonTitle}":s.L_3DLandmark_Share_Panel_Close,"{closeButtonAriaLabel}":s.L_3DLandmark_Share_Panel_Close,"{landmarksViewerPermalink}":""},y='\n        <canvas class="bm_map3DRenderCanvas" id="bm_map3DRenderCanvas"><\/canvas>\n        <div class="bm_3dlmkShare hide">\n            <button class="bm_3dlmkShareBtn"\n                    title="{shareButtonTitle}"\n                    tabindex="0"\n                    aria-label="{shareButtonAriaLabel}"><\/button>\n            <div class="bm_3dlmkSharePnl hide">\n                <div class="bm_sharePnlInput">\n                    <input class="bm_3dlmkShareUrl" type="text" value="{landmarksViewerPermalink}" />\n                    <div class="bm_pnlBtns">\n                        <button class="bm_3dlmkShareUrlBtn" id="share">\n                            {copyUrlButtonText}\n                        <\/button>\n                        <button class="bm_3dlmkShareUrlBtn" id="pnlClose">\n                            {sharePanelCloseText}\n                        <\/button>\n                    <\/div>\n                <\/div>\n                <div class="bm_sharePnlMsg hide">\n                    <span>\n                        {copyLinkSuccessText}\n                    <\/span>\n                    <button class="bm_3dlmkShareUrlBtn" id="msgClose">\n                        {sharePanelCloseText}\n                    <\/button>\n                <\/div>\n            <\/div>\n        <\/div>\n        <button class="bm_btnFeedback"\n            title="{feedbackButtonTitle}"\n            tabindex="0"\n            aria-label="{feedbackButtonAriaLabel}"><\/button>\n        <button class="bm_btnClose"\n            title="{closeButtonTitle}"\n            tabindex="0"\n            aria-label="{closeButtonAriaLabel}"><\/button>\n        <div class="bm_map3DCopyright"><\/div>\n    ',p=function(){for(var i,u,n=y,t=0,r=Object.keys(o);t<r.length;t++)i=r[t],u=new RegExp(i,"g"),n=n.replace(u,o[i]);return n},t=function(n,t){var i=n.className.replace("hide","");n.className=t?i:i+" hide"},l=function(n,t){var i=t>0?Math.pow(10,t):1;return Math.round(n*i)/i},a=function(n,t,i,u){var f=r.logger,e={feature:"MAP3D",action:n,data:{component:"M3D",LN:t,CTX:i,TS:u}};f.logObject(e)},e,v;(function(n){n[n.Landmark=0]="Landmark";n[n.Flyover=1]="Flyover"})(e=n.Map3DModeReference||(n.Map3DModeReference={}));v=function(o){function s(n,t,r,u){var f=o.call(this)||this;return f.onFeedbackBtnClick=new i,f.onCloseBtnClick=new i,f._componentName="M3D",f.modeReference=t,f.options=r,f.config=n,f.logger=u,f.disposables=[f.onCloseBtnClick,f.onFeedbackBtnClick],f}return c(s,o),s.prototype.onAdd=function(i){var o=this,l,h,s,v,y,c,w;if(l=u.dynamicProperties.sessionKey,!l)throw new Error("Session key is not defined");if(h=f._getUrlParam(window.location,"lmk3ddataver",!1),this.options.sessionId=l,this.options.market=u.dynamicProperties.uiLanguage,this.options.region=u.dynamicProperties.userRegion,this.options.rightToLeft=f._isRtl(),this.options.landmarkDataVersion=(h===null||h===void 0?void 0:h.length)===0?undefined:h,this.options.class=r.DeviceInfo.deviceClassification,this.options.styleVersion=u.stlVersion,s=this.buildContainer(i,atlas.ControlStyle.auto),s.className="bm_map3DViewer",s.innerHTML=p(),v=s.querySelector(".bm_btnClose"),!v)throw new Error("Can't find .bm_btnClose");if(v.addEventListener("click",function(t){o.onCloseBtnClick.invoke(t)}),u.isMapsVertical&&(y=s.querySelector(".bm_btnFeedback"),y.addEventListener("click",function(t){var i,r;r=(i=o.map3DControl.mode.currentTarget)===null||i===void 0?void 0:i.ypid;r&&a("C",r,"FDBK");o.onFeedbackBtnClick.invoke(t)}),y.style.display="inline-block"),this.setupShareButton(s),c=s.querySelector(".bm_map3DRenderCanvas"),!c)throw new Error("Could not get canvas");return c.style.width="100%",c.style.height="100%",w=!1,s.addEventListener("DOMNodeInserted",function(){if(!w){w=!0;o.options.workerUrlOverride=window.location.origin+o.config.webWorkerUrl;o.options.decoderWasmUrlOverride=window.location.origin+o.config.decoderWasmUrl;o.options.basisJSUrlOverride=window.location.origin+o.config.basisTranscoderUrl;o.options.basisWasmUrlOverride=window.location.origin+o.config.basisWasmUrl;var i=void 0;switch(o.modeReference){case e.Landmark:i=map3DBundle.Map3DLandmarkMode.build(o.options);break;case e.Flyover:i=map3DBundle.Map3DFlyoverMode.build(o.options);break;default:throw new Error;}i.then(function(i){if(o.disposables.length!==0){o.map3DControl=new map3DBundle.Map3DControl(c,i,o.logger);var r=s.querySelector(".bm_3dlmkShare");t(r,!!i.currentTarget);o.onTargetChangedObserver=o.map3DControl.mode.onTargetChanged.add(function(n){t(r,!!n)})}}).catch(function(t){o.onCloseBtnClick.invoke();throw t;})}}),s},s.prototype.dispose=function(){if(f._clearDisposables(this.disposables),this.map3DControl){this.onTargetChangedObserver&&this.map3DControl.mode.onTargetChanged.remove(this.onTargetChangedObserver);var t=this.map3DControl;this.map3DControl=undefined;t.dispose()}},s.prototype.setupShareButton=function(n){var s=this,i=!1,r=function(){var e,o,r,f,y,p,w;if(i)i=!1,y=n.querySelector(".bm_3dlmkShare .bm_sharePnlInput"),t(y,!0),p=n.querySelector(".bm_3dlmkShare .bm_sharePnlMsg"),t(p,!1);else if(r=s.map3DControl.mode.currentTarget,r){i=!0;f=r.ypid;f&&(f=f.replace("YN",""),a("C",f,"SHRE"));var b=r.name?encodeURIComponent(r.name):"",c=l(r.latitude,6),v=l(r.longitude,6),k=[c,v,r.altitude,(e=r.radius)!==null&&e!==void 0?e:200,(o=r.pitch)!==null&&o!==void 0?o:45,b,f],d=k.join("|"),g=h.shareLinkFormat.replace("{origin}",u.dynamicProperties.origin).replace("{latitude}",""+c).replace("{longitude}",""+v).replace("{props}",d),nt=n.querySelector("input.bm_3dlmkShareUrl");nt.value=g}w=n.querySelector(".bm_3dlmkShare .bm_3dlmkSharePnl");t(w,i)},c=function(){var u=function(){setTimeout(function(){var r=n.querySelector(".bm_sharePnlInput"),i;t(r,!1);i=n.querySelector(".bm_sharePnlMsg");t(i,!0);i.focus()},500)},i=n.querySelector("input.bm_3dlmkShareUrl"),r,f;i.focus();i.select();r=navigator.clipboard;r?r.writeText(i.value).then(u):(f=document.execCommand("copy"),f&&u())},v=n.querySelector(".bm_3dlmkShare"),f,e,o;v.querySelector(".bm_3dlmkShareBtn").addEventListener("click",r);f=n.querySelector("button#pnlClose");f.addEventListener("click",r);e=n.querySelector("button#msgClose");e.addEventListener("click",r);o=n.querySelector("button#share");o.addEventListener("click",c)},s}(atlas.control.ControlBase);n.Map3DViewerControl=v}(n||(n={})),function(n){var i='\n        <div class="bm_mapBuilderButton">\n            <div class="bm_mapBuilderButtonContentContainer">\n                <div id="bm_mapBuilderButtonIcon"><\/div>\n                <div id="bm_mapBuilderButtonText">\n                    {buttonLabel}\n                <\/div>\n            <\/div>\n        <\/div>\n    ',t=function(n){var t=r.logger,i={feature:"MB",action:n,data:{}};t.logObject(i)},o=function(r){function o(n){var t=r.call(this)||this;return t.flyoverButtonContainer=document.querySelector(".bm_flyoverButton"),t._disposables=[e.add(n,"moveend",function(){t.update(n)}),],t}return c(o,r),o.prototype.update=function(i){var r=n.MapBuilderDisplayHelper.isWithinBounds(i,p.boundsList),f;u.isMapsVertical&&(f=i.getCamera().zoom,r=r&&f>=p.minZoomLevel);r?(this.buttonContainer.style.display="flex",this.flyoverButtonContainer&&(this.flyoverButtonContainer.style.bottom=o.newFlyoverBottomPosition)):(this.buttonContainer.style.display="none",this.flyoverButtonContainer&&(this.flyoverButtonContainer.style.bottom=o.originalFlyoverBottomPosition));!this.isVisible&&r&&t("A");this.isVisible=r},o.prototype.dispose=function(){f._clearDisposables(this._disposables)},o.prototype.onAdd=function(n){var e=function(){var i=n.getCamera(),r=i.center,u=r[0],f=r[1],e=i.zoom,o=p.mapBuilderURL.replace("{zoomLevel}",e.toString()).replace("{longitude}",u.toString()).replace("{latitude}",f.toString());t("C");window.open(o)},o=function(n){(n.keyCode===13||n.keyCode===32)&&e()},h=i.replace("{buttonLabel}",s.L_MapBuilder_Button_Text),r=this.buttonContainer=this.buildContainer(n,atlas.ControlStyle.auto),f;return r.className="bm_mapBuilderButtonContainer",r.innerHTML=h,f=r.querySelector(".bm_mapBuilderButton"),(u.isMapsVertical||u.dynamicProperties.isMapsOverlay)&&(r.className+=" vertical",f.className+=" vertical"),f.tabIndex=0,f.addEventListener("click",e),f.addEventListener("keydown",o),r},o.prototype.getRootElement=function(){return this.buttonContainer},o.originalFlyoverBottomPosition="40px",o.newFlyoverBottomPosition="90px",o}(atlas.control.ControlBase);n.MapBuilderButtonControl=o}(n||(n={})),function(n){var t=function(t){function i(i){var r=this,u;return(p===null||p===void 0?void 0:p.isEnabled)&&(r=t.call(this,i)||this,u=r.mapBuilderButtonControl=new n.MapBuilderButtonControl(i),i.controls.add(u,{position:atlas.ControlPosition.NonFixed}),r._disposables=[e.add(i,"idle",function(){u.update(i)}),u]),r}return c(i,t),i.prototype.dispose=function(){this._isDisposed||this._map.controls.remove(this.mapBuilderButtonControl);t.prototype.dispose.call(this)},i.prototype.getControl=function(){return this.mapBuilderButtonControl},i}(k);n.MapBuilderDelegate=t}(n||(n={})),function(n){var t;(function(n){n.isWithinBounds=function(n,t){for(var e,i,r=!1,o=n.getCamera().bounds,u=0,f=t;u<f.length;u++){if(e=f[u],i=e.split(":"),i.length===5){var s=parseFloat(i[1]),h=parseFloat(i[2]),c=parseFloat(i[3]),l=parseFloat(i[4]),a=new w.Position(s,h),v=new w.Position(c,l),y=new w.BoundingBox(a,v);r=w.BoundingBox.intersect(o,y)}if(r)break}return r}})(t=n.MapBuilderDisplayHelper||(n.MapBuilderDisplayHelper={}))}(n||(n={})),function(n){var t;(function(n){function b(n,t,i){var r,f="",o,l;if(n.indexOf("ypid:")===0)r=g.localFilterFormat,f=encodeURIComponent(r.replace("{ypid}",n.substring(5))+" ");else if(n.indexOf("sid:")===0)r=g.entityFilterFormat,g.sendDoNotBlockResultsForSID&&i&&(r+='DoNotBlockResultsForSID:"false" '),f=encodeURIComponent(r.replace("{sid}",n.substring(4))+" ");else if(n.indexOf("eventId:")===0){r='eventId:"{eventId}" eventParentId:"{eventParentId}"';var e=void 0,s=void 0,c=n.indexOf("eventParentId:");c!==-1?(e=n.substring(8,c-1),s=n.substring(c+14)):(e=n.substring(8),s=e);f=encodeURIComponent(r.replace("{eventId}",e).replace("{eventParentId}",s)+" ");!t&&f&&(t=f)}return!t||!f?null:(o=g.infoboxUrlFormat.replace(new RegExp("{query}","gi"),encodeURIComponent(t.trim())).replace("{filter}",f).replace("{tid}",h).replace("{appid}",u.dynamicProperties.appId)+"&cardWidth=280",o.toLowerCase().indexOf("mcig")<0&&(l=u.dynamicProperties.mapsIG,l&&(o+="&MCIG="+l)),o)}function e(n,i,r){return new Promise(function(u,f){var o=b(n,i,r),e=v.downloadGeneric(o,"landmarkInfo",function(n){var i=n.replace(/src="\/th\?/g,'src="https://www.bing.com/th?').replace(/url\(\//g,"url(https://www.bing.com/"),r=l.replace("{firstPartyCss}",a.enableInfoboxActions?"":"first-party")+i+p;t&&t.delete(e);u(r)},null,function(){return f()});t.add(e)})}function k(n){var i=function(n,t){for(var u,r=t&&t.toLowerCase().indexOf("tripadvisor")>-1,e=r?"tartg_f sw_st":"sw_st",o=r?"tartg_hf sw_sth":"sw_sth",s=r?"tartg_e sw_ste":"sw_ste",f='<div><div class="me-b_factrow"><span class="csrc sc_rc1" role= "img" aria-label="Star Rating: '+n+' out of 10." >',i=0;i<10;i=i+2)u=s,n>i&&(u=n>i+1?e:o),f+='<span class="'.concat(u,'"><\/span>');return f+"<\/span><\/div><\/div>"},u=function(n){if(n){var t=n.split(":");if(t.length===3){if(parseInt(t[0])>0)return"".concat(parseInt(t[0]),"day");if(parseInt(t[1])>0)return"".concat(parseInt(t[1]),"hr")}}return""},e=function(t){var y=t.Ads,p=n.name,w=y.length,e=y[0],l=e.cpc,a="",v,o;l&&(v=ht.fromString(l).host,o=v&&v.split(".")||[],o.length>1&&(a="".concat(o[o.length-2],".").concat(o[o.length-1])));var b=e.category||"",h=parseInt(e.reviewCount),d=isNaN(h)?"":"(".concat(h<1e3?h.toString():(h/1e3).toFixed(1)+"k",")"),g=e.img?e.img+"&h=121&dpr="+f._getDpr():"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlMAQObYZgAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=",k=parseFloat(e.bingRating),nt=c.replace("{image}",g).replace("{title}",p||"").replace("{category}",b).replace("{morefacts}",i(k,e.ratingProvider)).replace("{price}",e.price?"from ".concat(e.price):"").replace("{adsUrl}",l||"").replace("{numdeals}",w>1?s.L_LandmarkDealsMore_Text.replace("{0}",""+(w-1)):"").replace("{reviewCount}",d).replace("{couponTitle}",e.title||p||"").replace("{duration}",u(e.duration)).replace("{provider}",a||"").replace("{categoryOpacity}",b?"1":"0").replace("{ratingOpacity}",isNaN(k)?"0":"1").replace("{providerDisplay}",a&&e.price?"block":"none");return r.replace("{content}",nt).replace("{firstPartyCss}","")};return new Promise(function(i,r){var u=n.ypid,f=y.landmarkDealsUrl.replace("{ypid}",u),o=v.downloadJson(f,"landmarkDeals",function(t,u){if(u===n.ypid&&t.Ads){var f=e(t);i(f)}else r()},r,u,null,0);t.add(o)})}function d(n){for(var t,i,r,s,u,l=[],f=[],e=0,a=n.routes;e<a.length;e++)if(t=a[e],i=t===null||t===void 0?void 0:t.names,i&&i.length>0)for(r=0,s=i;r<s.length;r++)u=s[r],u.length>o?f.push(u):l.push(u);var h=l.join(", "),c=f.length?"".concat(f.join("<br>")):"",v=h&&c?"".concat(h,"<br>").concat(c):"".concat(h).concat(c);return'\n                <div class="bm_transitPopup">\n                    <p class="bm_transitPopup_title">'.concat(n.name,'<\/p>\n                    <p class="bm_transitPopup_content">').concat(v,"<\/p>\n                <\/div>\n            ")}function nt(n){if(n.isCoupoi&&y.landmarkDeals)return k(n);var t="ypid:"+n.ypid;return e(t,n.name)}function tt(n,t,i){return e(n,t,i)}function it(n){return r.replace("{content}",w).replace("{htmlContent}",n)}function rt(){for(var n in this.dispatchKeys)v.abortRequest(n);t=new Set}var o=5,h=f._hasBingHeaders()&&_G.IG,c='\n            <div class="infoBoxLink">\n                <div class="bm_layerInfobox" id="infobox-container">\n                    <div class="infoboxBody clientSide coupoiInfobox">\n                        <div class="infoboxHouseImage coupoiImgCtr">\n                            <img class="infoboxBgImg" src="{image}" style="width:auto"/>\n                        <\/div>\n                        <div class="infoboxText coupoiContainer">\n                            <div class="titleLine">{title}<\/div>\n                            <div style="opacity:{ratingOpacity}">\n                                <span class="factsLine coupoiFactLine">{morefacts}<\/span>\n                                <span>{reviewCount}<\/span>\n                            <\/div>\n                            <div class="adContainer">\n                                <span class="adIcon">Ad<\/span>\n                                <span class="adDuration">{duration}<\/span>\n                                <span style="opacity:{categoryOpacity}">\n                                    <span class="adSeperator">.<\/span>\n                                    <span class="adCategory">{category}<\/span>\n                                <\/span>\n                            <\/div>\n                            <div class="coupoiAdLink">\n                                <a style="color:#333" id="adsLink" target="_blank" href="{adsUrl}">{couponTitle}<\/a>\n                            <\/div>\n                            <div style="float:left">\n                                <span class="adProvider">{provider}<\/span>\n                                <span class="adSeperator" style="display:{providerDisplay}">.<\/span>\n                                <span>{price}<\/span>\n                            <\/div>\n                        <\/div>\n                    <\/div>\n                <\/div>\n            <\/div>\n        ',i='<div class="MapsInfoboxContainer rich {firstPartyCss}">',l="\n            ".concat(i,'\n                <div class="infoBoxLink" role="button" tabindex="0">\n        '),p='\n                <\/div>\n                <div class="directionsPopOut" data-tag="directionsPopOut"><\/div>\n                <div class="collectionsPopOut"><\/div>\n            <\/div>\n        ',r="\n            ".concat(i,"\n                {content}\n            <\/div>\n        "),w='\n            <div class="rib_primer">\n                <a class="infoBoxLink" role="button" tabindex="0">\n                    <div class="bm_ib_container">\n                        <div class="bm_ib_title">\n                            <span class="cnm">\n                                {htmlContent}\n                            <\/span>\n                        <\/div>\n                    <\/div>\n                <\/a>\n            <\/div>\n        ',t=new Set;n.createTransitContent=d;n.createLandmarkContent=nt;n.createEntityContent=tt;n.createSimpleContent=it;n.abortContentRequests=rt})(t=n.InfoboxContentCreator||(n.InfoboxContentCreator={}))}(n||(n={})),function(n){var t;(function(n){function t(n,t,i,u){var o=u?"Landmark":"TransitStop",f={feature:"INF",action:n,data:{SRC:"Landmark",TYP:o,LBL:i,ID:t}},e;u&&n==="C"&&(f.data.Q=i);e=r.logger;e.logObject(f)}function i(n,i,r,f){var s,h,o,e,c;t("EX",n,i,r);typeof((s=Microsoft.Maps.Internal)===null||s===void 0?void 0:s.Helper)!="undefined"&&typeof((h=u===null||u===void 0?void 0:u.dynamicProperties)===null||h===void 0?void 0:h.mapsIG)!="undefined"&&typeof Microsoft.Maps.GlobalDataEventHandler!="undefined"&&(o=Microsoft.Maps.Internal.Helper._tryParsingWithDOMParser(f),e=o===null||o===void 0?void 0:o.select("div[data-ig]").get_attr("data-ig"),(e===null||e===void 0?void 0:e.length)>0&&(c={impressionGuid:u.dynamicProperties.mapsIG,logData:{feature:"MPV",action:"C",data:{P:"Page.Maps.Search",CIG:e}}},Microsoft.Maps.GlobalDataEventHandler.invokeHandler("data-instrumentation",c)))}function f(n,i,r){t("C",n,i,r)}n.logOpen=i;n.logClick=f})(t=n.InfoboxInstrumentation||(n.InfoboxInstrumentation={}))}(n||(n={})),function(n){var t=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._keepVisible=!1,r}return c(t,n),t.prototype.setOptions=function(t){var r,i;t.visible&&(i=document.getElementById("transientLens"),((r=i===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.visibility)==="visible")||(this._keepVisible&&(t.visible=!0),n.prototype.setOptions.call(this,t))},t.prototype._onMouseenter=function(){this.preventAutoClose=!0;this.infoboxEnter.invoke();this._keepVisible=!0},t.prototype._onMouseleave=function(){this.preventAutoClose=!1;this.infoboxLeave.invoke();this._keepVisible=!1;n.prototype.setOptions.call(this,{visible:!1,delayTime:150})},t}(ft);n.RichMapsInfobox=t}(n||(n={}));r.Delegates=n}catch(et){if(r&&r.logger)r.logger.logCriticalError(et);else throw et;}}).call(window)